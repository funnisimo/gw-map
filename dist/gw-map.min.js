!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("gw-utils")):"function"==typeof define&&define.amd?define(["exports","gw-utils"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GWM={},e.GWU)}(this,(function(e,t){"use strict";function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,t}var s=i(t);const l=s.flag.fl;var r;!function(e){e[e.L_SUPERPRIORITY=l(1)]="L_SUPERPRIORITY",e[e.L_SECRETLY_PASSABLE=l(2)]="L_SECRETLY_PASSABLE",e[e.L_BLOCKS_MOVE=l(3)]="L_BLOCKS_MOVE",e[e.L_BLOCKS_VISION=l(4)]="L_BLOCKS_VISION",e[e.L_BLOCKS_SURFACE=l(6)]="L_BLOCKS_SURFACE",e[e.L_BLOCKS_LIQUID=l(8)]="L_BLOCKS_LIQUID",e[e.L_BLOCKS_GAS=l(7)]="L_BLOCKS_GAS",e[e.L_BLOCKS_ITEMS=l(5)]="L_BLOCKS_ITEMS",e[e.L_BLOCKS_ACTORS=l(11)]="L_BLOCKS_ACTORS",e[e.L_BLOCKS_EFFECTS=l(9)]="L_BLOCKS_EFFECTS",e[e.L_BLOCKS_DIAGONAL=l(10)]="L_BLOCKS_DIAGONAL",e[e.L_INTERRUPT_WHEN_SEEN=l(12)]="L_INTERRUPT_WHEN_SEEN",e[e.L_LIST_IN_SIDEBAR=l(13)]="L_LIST_IN_SIDEBAR",e[e.L_VISUALLY_DISTINCT=l(14)]="L_VISUALLY_DISTINCT",e[e.L_BRIGHT_MEMORY=l(15)]="L_BRIGHT_MEMORY",e[e.L_INVERT_WHEN_HIGHLIGHTED=l(16)]="L_INVERT_WHEN_HIGHLIGHTED",e[e.L_BLOCKED_BY_STAIRS=e.L_BLOCKS_ITEMS|e.L_BLOCKS_SURFACE|e.L_BLOCKS_GAS|e.L_BLOCKS_LIQUID|e.L_BLOCKS_EFFECTS|e.L_BLOCKS_ACTORS]="L_BLOCKED_BY_STAIRS",e[e.L_BLOCKS_SCENT=e.L_BLOCKS_MOVE|e.L_BLOCKS_VISION]="L_BLOCKS_SCENT",e[e.L_DIVIDES_LEVEL=e.L_BLOCKS_MOVE]="L_DIVIDES_LEVEL",e[e.L_WAYPOINT_BLOCKER=e.L_BLOCKS_MOVE]="L_WAYPOINT_BLOCKER",e[e.L_WALL_FLAGS=e.L_BLOCKS_MOVE|e.L_BLOCKS_VISION|e.L_BLOCKS_LIQUID|e.L_BLOCKS_GAS|e.L_BLOCKS_EFFECTS|e.L_BLOCKS_DIAGONAL]="L_WALL_FLAGS",e[e.L_BLOCKS_EVERYTHING=e.L_WALL_FLAGS|e.L_BLOCKS_ITEMS|e.L_BLOCKS_ACTORS|e.L_BLOCKS_SURFACE]="L_BLOCKS_EVERYTHING"}(r||(r={}));class a{constructor(){this.sprite=new s.sprite.Sprite,this.depth=1,this.light=null,this.flags={entity:0},this.next=null,this.x=-1,this.y=-1}hasObjectFlag(e){return!!(this.flags.entity&e)}hasAllObjectFlags(e){return(this.flags.entity&e)===e}blocksMove(){return this.hasObjectFlag(r.L_BLOCKS_MOVE)}blocksVision(){return this.hasObjectFlag(r.L_BLOCKS_VISION)}blocksPathing(){return this.hasObjectFlag(r.L_BLOCKS_MOVE)}blocksEffects(){return this.hasObjectFlag(r.L_BLOCKS_EFFECTS)}}var n,h={__proto__:null,Entity:a};!function(e){e[e.ALL_LAYERS=-1]="ALL_LAYERS",e[e.GROUND=0]="GROUND",e[e.SURFACE=1]="SURFACE",e[e.ITEM=2]="ITEM",e[e.ACTOR=3]="ACTOR",e[e.LIQUID=4]="LIQUID",e[e.GAS=5]="GAS",e[e.FX=6]="FX",e[e.UI=7]="UI"}(n||(n={}));const c=s.flag.fl;var _;!function(e){e[e.IS_PLAYER=c(0)]="IS_PLAYER"}(_||(_={}));const o=s.flag.fl;var E;!function(e){e[e.T_BRIDGE=o(0)]="T_BRIDGE",e[e.T_AUTO_DESCENT=o(1)]="T_AUTO_DESCENT",e[e.T_LAVA=o(2)]="T_LAVA",e[e.T_DEEP_WATER=o(3)]="T_DEEP_WATER",e[e.T_IS_FLAMMABLE=o(5)]="T_IS_FLAMMABLE",e[e.T_SPONTANEOUSLY_IGNITES=o(6)]="T_SPONTANEOUSLY_IGNITES",e[e.T_IS_FIRE=o(7)]="T_IS_FIRE",e[e.T_EXTINGUISHES_FIRE=o(8)]="T_EXTINGUISHES_FIRE",e[e.T_IS_SECRET=o(9)]="T_IS_SECRET",e[e.T_IS_TRAP=o(10)]="T_IS_TRAP",e[e.T_SACRED=o(11)]="T_SACRED",e[e.T_UP_STAIRS=o(12)]="T_UP_STAIRS",e[e.T_DOWN_STAIRS=o(13)]="T_DOWN_STAIRS",e[e.T_PORTAL=o(14)]="T_PORTAL",e[e.T_IS_DOOR=o(15)]="T_IS_DOOR",e[e.T_ALLOWS_SUBMERGING=o(16)]="T_ALLOWS_SUBMERGING",e[e.T_ENTANGLES=o(17)]="T_ENTANGLES",e[e.T_REFLECTS=o(18)]="T_REFLECTS",e[e.T_STAND_IN_TILE=o(19)]="T_STAND_IN_TILE",e[e.T_CONNECTS_LEVEL=o(20)]="T_CONNECTS_LEVEL",e[e.T_BLOCKS_OTHER_LAYERS=o(21)]="T_BLOCKS_OTHER_LAYERS",e[e.T_HAS_STAIRS=e.T_UP_STAIRS|e.T_DOWN_STAIRS|e.T_PORTAL]="T_HAS_STAIRS",e[e.T_OBSTRUCTS_SCENT=e.T_AUTO_DESCENT|e.T_LAVA|e.T_DEEP_WATER|e.T_SPONTANEOUSLY_IGNITES|e.T_HAS_STAIRS]="T_OBSTRUCTS_SCENT",e[e.T_PATHING_BLOCKER=e.T_AUTO_DESCENT|e.T_IS_TRAP|e.T_LAVA|e.T_DEEP_WATER|e.T_IS_FIRE|e.T_SPONTANEOUSLY_IGNITES|e.T_ENTANGLES]="T_PATHING_BLOCKER",e[e.T_LAKE_PATHING_BLOCKER=e.T_AUTO_DESCENT|e.T_LAVA|e.T_DEEP_WATER|e.T_SPONTANEOUSLY_IGNITES]="T_LAKE_PATHING_BLOCKER",e[e.T_WAYPOINT_BLOCKER=e.T_AUTO_DESCENT|e.T_IS_TRAP|e.T_LAVA|e.T_DEEP_WATER|e.T_SPONTANEOUSLY_IGNITES]="T_WAYPOINT_BLOCKER",e[e.T_DIVIDES_LEVEL=e.T_AUTO_DESCENT|e.T_IS_TRAP|e.T_LAVA|e.T_DEEP_WATER]="T_DIVIDES_LEVEL",e[e.T_MOVES_ITEMS=e.T_DEEP_WATER|e.T_LAVA]="T_MOVES_ITEMS",e[e.T_CAN_BE_BRIDGED=e.T_AUTO_DESCENT|e.T_LAVA|e.T_DEEP_WATER]="T_CAN_BE_BRIDGED",e[e.T_IS_DEEP_LIQUID=e.T_LAVA|e.T_AUTO_DESCENT|e.T_DEEP_WATER]="T_IS_DEEP_LIQUID"}(E||(E={}));const f=s.flag.fl;var T;!function(e){e[e.TM_IS_WIRED=f(9)]="TM_IS_WIRED",e[e.TM_IS_CIRCUIT_BREAKER=f(10)]="TM_IS_CIRCUIT_BREAKER",e[e.TM_VANISHES_UPON_PROMOTION=f(15)]="TM_VANISHES_UPON_PROMOTION",e[e.TM_EXPLOSIVE_PROMOTE=f(21)]="TM_EXPLOSIVE_PROMOTE",e[e.TM_SWAP_ENCHANTS_ACTIVATION=f(25)]="TM_SWAP_ENCHANTS_ACTIVATION"}(T||(T={}));const u=s.flag.fl;var S;!function(e){e[e.SEARCHED_FROM_HERE=u(0)]="SEARCHED_FROM_HERE",e[e.PRESSURE_PLATE_DEPRESSED=u(1)]="PRESSURE_PLATE_DEPRESSED",e[e.KNOWN_TO_BE_TRAP_FREE=u(2)]="KNOWN_TO_BE_TRAP_FREE",e[e.CAUGHT_FIRE_THIS_TURN=u(3)]="CAUGHT_FIRE_THIS_TURN",e[e.EVENT_FIRED_THIS_TURN=u(4)]="EVENT_FIRED_THIS_TURN",e[e.EVENT_PROTECTED=u(5)]="EVENT_PROTECTED",e[e.IS_IN_LOOP=u(6)]="IS_IN_LOOP",e[e.IS_CHOKEPOINT=u(7)]="IS_CHOKEPOINT",e[e.IS_GATE_SITE=u(8)]="IS_GATE_SITE",e[e.IS_IN_ROOM_MACHINE=u(9)]="IS_IN_ROOM_MACHINE",e[e.IS_IN_AREA_MACHINE=u(10)]="IS_IN_AREA_MACHINE",e[e.IS_POWERED=u(11)]="IS_POWERED",e[e.IMPREGNABLE=u(12)]="IMPREGNABLE",e[e.NEEDS_REDRAW=u(14)]="NEEDS_REDRAW",e[e.CELL_CHANGED=u(15)]="CELL_CHANGED",e[e.HAS_SURFACE=u(16)]="HAS_SURFACE",e[e.HAS_LIQUID=u(17)]="HAS_LIQUID",e[e.HAS_GAS=u(18)]="HAS_GAS",e[e.HAS_PLAYER=u(19)]="HAS_PLAYER",e[e.HAS_ACTOR=u(20)]="HAS_ACTOR",e[e.HAS_DORMANT_MONSTER=u(21)]="HAS_DORMANT_MONSTER",e[e.HAS_ITEM=u(22)]="HAS_ITEM",e[e.IS_IN_PATH=u(23)]="IS_IN_PATH",e[e.IS_CURSOR=u(24)]="IS_CURSOR",e[e.STABLE_MEMORY=u(25)]="STABLE_MEMORY",e[e.IS_WIRED=u(26)]="IS_WIRED",e[e.IS_CIRCUIT_BREAKER=u(27)]="IS_CIRCUIT_BREAKER",e[e.COLORS_DANCE=u(30)]="COLORS_DANCE",e[e.IS_IN_MACHINE=e.IS_IN_ROOM_MACHINE|e.IS_IN_AREA_MACHINE]="IS_IN_MACHINE",e[e.PERMANENT_CELL_FLAGS=e.HAS_ITEM|e.HAS_DORMANT_MONSTER|e.STABLE_MEMORY|e.SEARCHED_FROM_HERE|e.PRESSURE_PLATE_DEPRESSED|e.KNOWN_TO_BE_TRAP_FREE|e.IS_IN_LOOP|e.IS_CHOKEPOINT|e.IS_GATE_SITE|e.IS_IN_MACHINE|e.IMPREGNABLE]="PERMANENT_CELL_FLAGS",e[e.HAS_ANY_ACTOR=e.HAS_PLAYER|e.HAS_ACTOR]="HAS_ANY_ACTOR",e[e.HAS_ANY_OBJECT=e.HAS_ITEM|e.HAS_ANY_ACTOR]="HAS_ANY_OBJECT",e[e.CELL_DEFAULT=e.NEEDS_REDRAW|e.CELL_CHANGED]="CELL_DEFAULT"}(S||(S={}));const g=s.flag.fl;var L;!function(e){e[e.MAP_CHANGED=g(0)]="MAP_CHANGED",e[e.MAP_ALWAYS_LIT=g(3)]="MAP_ALWAYS_LIT",e[e.MAP_SAW_WELCOME=g(4)]="MAP_SAW_WELCOME",e[e.MAP_NO_LIQUID=g(5)]="MAP_NO_LIQUID",e[e.MAP_NO_GAS=g(6)]="MAP_NO_GAS",e[e.MAP_CALC_FOV=g(7)]="MAP_CALC_FOV",e[e.MAP_FOV_CHANGED=g(8)]="MAP_FOV_CHANGED",e[e.MAP_DANCES=g(9)]="MAP_DANCES",e[e.MAP_DEFAULT=0]="MAP_DEFAULT"}(L||(L={}));class A extends a{constructor(){super(),this.next=null,this.flags=this.flags||{},this.flags.actor=0,this.depth=n.ACTOR}hasActorFlag(e){return!!(this.flags.actor&e)}hasAllActorFlags(e){return(this.flags.actor&e)===e}actorFlags(){return this.flags.actor}isPlayer(){return this.hasActorFlag(_.IS_PLAYER)}isVisible(){return!0}forbidsCell(e){return!1}getName(){return""}getDescription(){return""}getFlavor(){return""}}var I={__proto__:null,Actor:A};class R{}const O={};function d(e){return e instanceof R?e:O[e]}function C(e){return new R}class p extends a{constructor(e){super(),this.quantity=1,this.next=null,this.flags=this.flags||{},this.flags.item=0,this.depth=n.ITEM,this.kind=e}itemFlags(){return this.flags.item}hasItemFlag(e){return!!(this.flags.item&e)}hasAllItemFlags(e){return(this.flags.item&e)===e}forbidsCell(e){return!1}getName(){return""}getDescription(){return""}getFlavor(){return""}}var m={__proto__:null,ItemKind:R,kinds:O,install:function(e,t){return new R},get:d,makeKind:C,Item:p,make:function(e){const t=d(e);if(!t)throw new Error("Failed to find item kind - "+e);return new p(t)},from:function(e){let t;if("string"==typeof e){if(t=d(e),!t)throw new Error("Failed to find item kind - "+e)}else t=e instanceof R?e:C();return new p(t)}};const N=s.flag.fl;var y;function F(e){var t;if(!e)throw new Error("opts required to make effect.");if("string"==typeof e)throw new Error("Cannot make effect from string: "+e);"function"==typeof e&&(e={fn:e});const i={flags:s.flag.from(y,e.flags),chance:null!==(t=e.chance)&&void 0!==t?t:0,next:null,id:e.id||"n/a"};return e.next&&("string"==typeof e.next?i.next=e.next:i.next=F(e.next)),Object.values(w).forEach((t=>t.make(e,i))),i}function D(e){if(!e)throw new Error("Cannot make effect from null | undefined");if("string"==typeof e){const t=P[e];if(t)return t;throw new Error("Unknown effect - "+e)}return F(e)}function M(e){e.flags&=~y.E_FIRED}!function(e){e[e.E_NEXT_ALWAYS=N(0)]="E_NEXT_ALWAYS",e[e.E_NEXT_EVERYWHERE=N(1)]="E_NEXT_EVERYWHERE",e[e.E_FIRED=N(2)]="E_FIRED",e[e.E_NO_MARK_FIRED=N(3)]="E_NO_MARK_FIRED",e[e.E_PROTECTED=N(4)]="E_PROTECTED",e[e.E_TREAT_AS_BLOCKING=N(5)]="E_TREAT_AS_BLOCKING",e[e.E_PERMIT_BLOCKING=N(6)]="E_PERMIT_BLOCKING",e[e.E_ABORT_IF_BLOCKS_MAP=N(7)]="E_ABORT_IF_BLOCKS_MAP",e[e.E_BLOCKED_BY_ITEMS=N(8)]="E_BLOCKED_BY_ITEMS",e[e.E_BLOCKED_BY_ACTORS=N(9)]="E_BLOCKED_BY_ACTORS",e[e.E_BLOCKED_BY_OTHER_LAYERS=N(10)]="E_BLOCKED_BY_OTHER_LAYERS",e[e.E_SUPERPRIORITY=N(11)]="E_SUPERPRIORITY",e[e.E_SPREAD_CIRCLE=N(13)]="E_SPREAD_CIRCLE",e[e.E_SPREAD_LINE=N(14)]="E_SPREAD_LINE",e[e.E_EVACUATE_CREATURES=N(15)]="E_EVACUATE_CREATURES",e[e.E_EVACUATE_ITEMS=N(16)]="E_EVACUATE_ITEMS",e[e.E_BUILD_IN_WALLS=N(17)]="E_BUILD_IN_WALLS",e[e.E_MUST_TOUCH_WALLS=N(18)]="E_MUST_TOUCH_WALLS",e[e.E_NO_TOUCH_WALLS=N(19)]="E_NO_TOUCH_WALLS",e[e.E_CLEAR_GROUND=N(21)]="E_CLEAR_GROUND",e[e.E_CLEAR_SURFACE=N(22)]="E_CLEAR_SURFACE",e[e.E_CLEAR_LIQUID=N(23)]="E_CLEAR_LIQUID",e[e.E_CLEAR_GAS=N(24)]="E_CLEAR_GAS",e[e.E_CLEAR_TILE=N(25)]="E_CLEAR_TILE",e[e.E_CLEAR_CELL=e.E_CLEAR_GROUND|e.E_CLEAR_SURFACE|e.E_CLEAR_LIQUID|e.E_CLEAR_GAS]="E_CLEAR_CELL",e[e.E_ONLY_IF_EMPTY=e.E_BLOCKED_BY_ITEMS|e.E_BLOCKED_BY_ACTORS]="E_ONLY_IF_EMPTY",e[e.E_ACTIVATE_DORMANT_MONSTER=N(27)]="E_ACTIVATE_DORMANT_MONSTER",e[e.E_AGGRAVATES_MONSTERS=N(28)]="E_AGGRAVATES_MONSTERS",e[e.E_RESURRECT_ALLY=N(29)]="E_RESURRECT_ALLY"}(y||(y={}));const P={};function b(e,t){const i=F(t);return P[e]=i,i.id=e,i}const w={};function U(e,t){w[e]=t}async function B(e,t,i,l,r={}){if(!e)return!1;if("string"==typeof e){const t=e;if(!(e=D(t)))throw new Error("Failed to find effect: "+t)}const a=r;if(!a.force&&e.chance&&!s.random.chance(e.chance,1e4))return!1;const n=a.grid=s.grid.alloc(t.width,t.height);let h=!0;const c=Object.values(w);for(let s of c)await s.fire(e,t,i,l,a)&&(h=!0);if(!h||!t.isVisible(i,l)||e.flags&y.E_NO_MARK_FIRED||(e.flags|=y.E_FIRED),e.next&&(h||e.flags&y.E_NEXT_ALWAYS)&&!s.data.gameHasEnded){const s="string"==typeof e.next?D(e.next):e.next;e.flags&y.E_NEXT_EVERYWHERE?await n.forEachAsync((async(e,i,l)=>{e&&await B(s,t,i,l,a)})):await B(s,t,i,l,a)}return s.grid.free(n),h}function v(e,t,i,l,r={}){if(!e)return!1;if("string"==typeof e){const t=e;if(!(e=D(t)))throw new Error("Failed to find effect: "+t)}const a=r;if(!a.force&&e.chance&&!s.random.chance(e.chance,1e4))return!1;const n=a.grid=s.grid.alloc(t.width,t.height);let h=!0;const c=Object.values(w);for(let s of c)s.fireSync(e,t,i,l,a)&&(h=!0);if(!h||!t.isVisible(i,l)||e.flags&y.E_NO_MARK_FIRED||(e.flags|=y.E_FIRED),e.next&&(h||e.flags&y.E_NEXT_ALWAYS)&&!s.data.gameHasEnded){const s="string"==typeof e.next?D(e.next):e.next;e.flags&y.E_NEXT_EVERYWHERE?n.forEach((async(e,i,l)=>{e&&v(s,t,i,l,a)})):v(s,t,i,l,a)}return s.grid.free(n),h}class H{make(e,t){if(!e.message)return!0;if("string"!=typeof e.message)throw new Error("Emit must be configured with name of event to emit");return t.message=e.message,!0}async fire(e,t,i,l,r){if(!e.message)return!1;const a=!!(e.flags&y.E_FIRED);return!(!e.message||!e.message.length||a||!t.isVisible(i,l))&&(s.message.addAt(i,l,e.message,r),!0)}fireSync(e,t,i,s,l){if(!e.message)return!1;throw new Error('Cannot use "message" effects in build steps.')}}U("message",new H);class K{make(e,t){if(!e.emit)return!0;if("string"!=typeof e.emit)throw new Error('emit effects must be string name to emit: { emit: "EVENT" }');return t.emit=e.emit,!0}async fire(e,t,i,l,r){return!!e.emit&&await s.events.emit(e.emit,i,l,r)}fireSync(e,t,i,s,l){if(!e.emit)return!1;throw new Error('Cannot use "emit" effects in build steps.')}}U("emit",new K);class k{make(e,t){if(!e.fn)return!0;if("function"!=typeof e.fn)throw new Error("fn effects must be functions.");return t.fn=e.fn,!0}async fire(e,t,i,s,l){return!!e.fn&&await e.fn(e,t,i,s,l)}fireSync(e,t,i,s,l){if(e.fn){const r=e.fn(e,t,i,s,l);if(!0===r||!1===r)return r;throw new Error("Cannot use async function effects in build steps.")}return!1}}U("fn",new k);class G{make(e,t){return!e.activateMachine||(t.activateMachine=!0,!0)}async fire(e,t,i,s,l){if(e.activateMachine){const e=t.cell(i,s).machineId;return!!e&&await t.activateMachine(e,i,s,l)}return!1}fireSync(e,t,i,s,l){if(e.activateMachine){const e=t.cell(i,s).machineId;return!!e&&t.activateMachineSync(e,i,s,l)}return!1}}U("activateMachine",new G);var Y={__proto__:null,get Flags(){return y},reset:M,resetAll:function(){Object.values(P).forEach((e=>M(e)))},effects:P,install:b,installAll:function(e){Object.entries(e).forEach((([e,t])=>{b(e,t)}))},handlers:w,installHandler:U,make:F,from:D,fire:B,fireSync:v,MessageEffect:H,EmitEffect:K,FnEffect:k,ActivateMachineEffect:G};class V{constructor(e){var t,i,l,r;this.index=-1,this.dissipate=2e3,this.effects={},this.priority=50,this.depth=0,this.light=null,this.groundTile=null,this.id=e.id||"n/a",this.dissipate=null!==(t=e.dissipate)&&void 0!==t?t:this.dissipate,this.priority=null!==(i=e.priority)&&void 0!==i?i:this.priority,this.depth=null!==(l=e.depth)&&void 0!==l?l:this.depth,this.light=e.light||null,this.groundTile=e.groundTile||null,this.sprite=s.sprite.make(e),this.name=e.name||"tile",this.description=e.description||this.name,this.flavor=e.flavor||this.name,this.article=null!==(r=e.article)&&void 0!==r?r:null,this.flags=e.flags||{entity:0,tile:0,tileMech:0},e.effects&&Object.assign(this.effects,e.effects),this.hasEffect("fire")&&(this.flags.tile|=E.T_IS_FLAMMABLE)}hasObjectFlag(e){return!!(this.flags.entity&e)}hasTileFlag(e){return!!(this.flags.tile&e)}hasTileMechFlag(e){return!!(this.flags.tileMech&e)}hasAllObjectFlags(e){return(this.flags.entity&e)===e}hasAllTileFlags(e){return(this.flags.tile&e)===e}hasAllTileMechFlags(e){return(this.flags.tileMech&e)===e}blocksVision(){return!!(this.flags.entity&r.L_BLOCKS_VISION)}blocksMove(){return!!(this.flags.entity&r.L_BLOCKS_MOVE)}blocksPathing(){return this.blocksMove()||this.hasTileFlag(E.T_PATHING_BLOCKER)}blocksEffects(){return!!(this.flags.entity&r.L_BLOCKS_EFFECTS)}hasEffect(e){return e in this.effects}getName(e){let t={};if(!0===e||!1===e||"string"==typeof e?t.article=e:e&&(t=e),!t.article&&!t.color)return this.name;let i=this.name;if(t.color){let e=t.color;!0===t.color&&(e=this.sprite.fg||"white"),"string"!=typeof e&&(e=s.color.from(e).toString()),i=`Ω${e}Ω${this.name}∆`}if(t.article){i=("string"==typeof t.article?t.article:this.article||"a")+" "+i}return i}getDescription(){return this.description||this.getName()}getFlavor(){return this.flavor||this.getName()}}function W(e){var t,i,l,a,h,c;let _={effects:{},flags:{},sprite:{},priority:50};if(e.extends&&(_=x[e.extends],!_))throw new Error("Failed to find base tile: "+e.extends);let o=-1;if("string"==typeof e.priority){let t=e.priority.replace(/ /g,""),i=t.search(/[+-]/);if(0==i)o=_.priority+Number.parseInt(t);else if(-1==i)if(0==t.search(/[a-zA-Z]/)){const e=x[t];if(!e)throw new Error("Failed to find tile for priority - "+t+".");o=e.priority}else o=Number.parseInt(t);else{const e=t.substring(0,i),s=Number.parseInt(t.substring(i)),l=x[e];if(!l)throw new Error("Failed to find tile for priority - "+e+".");o=l.priority+s}}else void 0!==e.priority&&(o=e.priority);const f={};Object.assign(f,_.effects),e.effects&&Object.entries(e.effects).forEach((([e,t])=>{null!==t?f[e]="string"!=typeof t?F(t):t:delete f[e]}));const u={entity:s.flag.from(r,_.flags.entity,e.flags),tile:s.flag.from(E,_.flags.tile,e.flags),tileMech:s.flag.from(T,_.flags.tileMech,e.flags)};let S=_.depth||0;e.depth&&(S="string"==typeof e.depth?n[e.depth]:e.depth);let g=_.light;e.light?g=s.light.make(e.light):null===e.light&&(g=null);const L={id:e.id,flags:u,dissipate:null!==(t=e.dissipate)&&void 0!==t?t:_.dissipate,effects:f,priority:-1!=o?o:void 0,depth:S,light:g,groundTile:e.groundTile||null,ch:null!==(i=e.ch)&&void 0!==i?i:_.sprite.ch,fg:null!==(l=e.fg)&&void 0!==l?l:_.sprite.fg,bg:null!==(a=e.bg)&&void 0!==a?a:_.sprite.bg,opacity:null!==(h=e.opacity)&&void 0!==h?h:_.sprite.opacity,name:e.name||_.name,description:e.description||_.description,flavor:e.flavor||_.flavor,article:null!==(c=e.article)&&void 0!==c?c:_.article};return new V(L)}const x={},j=[];function X(e){return e instanceof V?e:"string"==typeof e?x[e]||null:j[e]||null}function Q(e,...t){let i=t[0];2==t.length&&(i=t[1],i.extends=t[0]),i.id=e;const s=W(i);return s.index=j.length,j.push(s),x[e]=s,s}Q("NULL",{ch:"∅",fg:"white",bg:"black",flags:"L_BLOCKS_MOVE",name:"eerie nothingness",article:"an",priority:0}),Q("FLOOR",{ch:"·",fg:[30,30,30,20,0,0,0],bg:[2,2,10,0,2,2,0],priority:10,article:"the"}),Q("DOOR",{ch:"+",fg:[100,40,40],bg:[30,60,60],priority:30,flags:"T_IS_DOOR, L_BLOCKS_EFFECTS, L_BLOCKS_ITEMS, L_BLOCKS_VISION, L_VISUALLY_DISTINCT",article:"a",effects:{enter:{tile:"DOOR_OPEN"},open:{tile:"DOOR_OPEN_ALWAYS"}}}),Q("DOOR_OPEN","DOOR",{ch:"'",fg:[100,40,40],bg:[30,60,60],priority:40,flags:"!L_BLOCKS_ITEMS, !L_BLOCKS_VISION",name:"open door",article:"an",effects:{tick:{chance:1e4,tile:"DOOR",flags:"E_SUPERPRIORITY, E_ONLY_IF_EMPTY"},enter:null,open:null,close:{tile:"DOOR",flags:"E_SUPERPRIORITY, E_ONLY_IF_EMPTY"}}}),Q("DOOR_OPEN_ALWAYS","DOOR_OPEN",{effects:{tick:null,close:{tile:"DOOR",flags:"E_SUPERPRIORITY, E_ONLY_IF_EMPTY"}}}),Q("UP_STAIRS",{ch:"<",fg:[100,50,50],bg:[40,20,20],priority:200,flags:"T_UP_STAIRS, L_BLOCKED_BY_STAIRS, L_VISUALLY_DISTINCT, L_LIST_IN_SIDEBAR",name:"upward staircase",article:"an",effects:{player:{emit:"UP_STAIRS"}}}),Q("DOWN_STAIRS",{ch:">",fg:[100,50,50],bg:[40,20,20],priority:200,flags:"T_DOWN_STAIRS, L_BLOCKED_BY_STAIRS, L_VISUALLY_DISTINCT, L_LIST_IN_SIDEBAR",name:"downward staircase",article:"a",effects:{player:{emit:"DOWN_STAIRS"}}}),Q("WALL",{ch:"#",fg:[7,7,7,0,3,3,3],bg:[40,40,40,10,10,0,5],priority:100,flags:"L_WALL_FLAGS",article:"a",name:"stone wall",description:"A wall made from rough cut stone.",flavor:"a rough stone wall"}),Q("IMPREGNABLE",{ch:"#",fg:[7,7,7,0,3,3,3],bg:[40,40,40,10,10,0,5],priority:100,flags:"L_WALL_FLAGS, IMPREGNABLE",article:"a",name:"impregnable wall",description:"A wall made from very hard stone.",flavor:"an impregnable wall"}),Q("LAKE",{ch:"~",fg:[5,8,20,10,0,4,15,!0],bg:[10,15,41,6,5,5,5,!0],priority:50,flags:"T_DEEP_WATER",name:"deep water",article:"the"}),Q("SHALLOW",{ch:"·",fg:[5,8,10,10,0,4,15,!0],bg:[10,30,30,6,0,10,10,!0],priority:20,name:"shallow water",article:"the",depth:"SURFACE"}),Q("BRIDGE",{ch:"=",fg:[100,40,40],priority:40,depth:"SURFACE",flags:"T_BRIDGE, L_VISUALLY_DISTINCT",article:"a",groundTile:"LAKE"});const q={Tile:E,TileMech:T};var z={__proto__:null,flags:q,Tile:V,make:W,tiles:x,all:j,get:X,install:Q,installAll:function(e){Object.entries(e).forEach((([e,t])=>{Q(e,t)}))}};class J{constructor(e){this.cell=e}eachItem(e){let t=this.cell._item;for(;t;)e(t),t=t.next}eachActor(e){let t=this.cell._actor;for(;t;)e(t),t=t.next}forEach(e){this.eachItem(e),this.eachActor(e)}some(e){let t=this.cell._item;for(;t;){if(e(t))return!0;t=t.next}for(t=this.cell._actor;t;){if(e(t))return!0;t=t.next}return!1}reduce(e,t){let i=this.cell._item;for(;i;)t=void 0===t?i:e(t,i),i=i.next;for(i=this.cell._actor;i;)t=void 0===t?i:e(t,i),i=i.next;return t}}class ${constructor(e){if(this.chokeCount=0,this.machineId=0,this._actor=null,this._item=null,this._objects=new J(this),this.flags={cell:0},this.tiles=[x.NULL],e){const t=X(e);this.setTile(t)}}copy(e){Object.assign(this.flags,e.flags),this.chokeCount=e.chokeCount,this.tiles=e.tiles.slice(),this._actor=e._actor,this._item=e._item}hasCellFlag(e){return!!(this.flags.cell&e)}setCellFlag(e){this.flags.cell|=e}clearCellFlag(e){this.flags.cell&=~e}hasObjectFlag(e){return this.tiles.some((t=>t&&t.flags.entity&e))||this._objects.some((t=>!!(t.flags.entity&e)))}hasAllObjectFlags(e){return(this.objectFlags()&e)==e}hasTileFlag(e){return this.tiles.some((t=>t&&t.flags.tile&e))}hasAllTileFlags(e){return(this.tileFlags()&e)==e}hasTileMechFlag(e){return this.tiles.some((t=>t&&t.flags.tileMech&e))}hasAllTileMechFlags(e){return(this.tileMechFlags()&e)==e}cellFlags(){return this.flags.cell}objectFlags(){return this.tiles.reduce(((e,t)=>e|(t?t.flags.entity:0)),0)|this._objects.reduce(((e,t)=>e|t.flags.entity),0)}tileFlags(){return this.tiles.reduce(((e,t)=>e|(t?t.flags.tile:0)),0)}tileMechFlags(){return this.tiles.reduce(((e,t)=>e|(t?t.flags.tileMech:0)),0)}itemFlags(){let e=0;return this._objects.eachItem((t=>{e|=t.flags.item})),e}actorFlags(){let e=0;return this._objects.eachActor((t=>{e|=t.flags.actor})),e}get needsRedraw(){return!!(this.flags.cell&S.NEEDS_REDRAW)}set needsRedraw(e){e?this.flags.cell|=S.NEEDS_REDRAW:this.flags.cell&=~S.NEEDS_REDRAW}depthPriority(e){const t=this.tiles[e];return t?t.priority:x.NULL.priority}highestPriority(){return this.tiles.reduce(((e,t)=>Math.max(e,t?t.priority:0)),x.NULL.priority)}depthTile(e){return this.tiles[e]||null}hasTile(e){return e?(e instanceof V||(e=X(e)),this.tiles.includes(e)):this.tiles.some((e=>e))}hasDepthTile(e){const t=this.tiles[e];return!!t&&t!==x.NULL}highestPriorityTile(){return this.tiles.reduce(((e,t)=>t&&t.priority>=e.priority?t:e),x.NULL)}get tile(){return this.highestPriorityTile()}eachTile(e){this.tiles.forEach((t=>t&&e(t)))}tileWithObjectFlag(e){return this.tiles.find((t=>t&&t.flags.entity&e))||null}tileWithFlag(e){return this.tiles.find((t=>t&&t.flags.tile&e))||null}tileWithMechFlag(e){return this.tiles.find((t=>t&&t.flags.tileMech&e))||null}blocksVision(){return this.tiles.some((e=>e&&e.blocksVision()))||this._objects.some((e=>e.blocksVision()))}blocksPathing(){return this.tiles.some((e=>e&&e.blocksPathing()))||this._objects.some((e=>e.blocksPathing()))}blocksMove(){return this.tiles.some((e=>e&&e.blocksMove()))||this._objects.some((e=>e.blocksMove()))}blocksEffects(){return this.tiles.some((e=>e&&e.blocksEffects()))||this._objects.some((e=>e.blocksEffects()))}blocksLayer(e){return this.tiles.some((t=>t&&!!(t.flags.tile&q.Tile.T_BLOCKS_OTHER_LAYERS)&&t.depth!=e))}isEmpty(){return this.tiles.every((e=>!e||e===x.NULL))&&null==this._actor&&null==this._item}isPassable(){return!this.blocksMove()}isWall(){return this.hasAllObjectFlags(r.L_WALL_FLAGS)}isStairs(){return this.hasTileFlag(E.T_HAS_STAIRS)}hasKey(){return!1}setTile(e){return!!(e instanceof V||(e=X(e)))&&(this.tiles[e.depth]=e,this.needsRedraw=!0,!0)}clear(){this.tiles=[x.NULL],this.needsRedraw=!0,this.flags.cell=0,this.chokeCount=0,this._actor=null,this._item=null}clearDepth(e){return 0==e?(this.tiles[0]=x.NULL,this.needsRedraw=!0,!0):null!==this.tiles[e]&&(this.tiles[e]=null,this.needsRedraw=!0,!0)}clearDepthsWithFlags(e,t=0){for(let i=0;i<this.tiles.length;++i){const s=this.tiles[i];s&&(s.hasTileFlag(e)&&(t&&!s.hasTileMechFlag(t)||this.clearDepth(i)))}}eachGlowLight(e){this.tiles.forEach((t=>{t&&t.light&&e(t.light)}))}async activate(e,t,i,s,l={}){l.cell=this;let r=!1;if(void 0!==l.depth){const a=l.tile=this.depthTile(l.depth);if(a&&a.effects){const n=a.effects[e];r=await this._fire(n,t,i,s,l)}}else for(l.tile of this.tiles){if(!l.tile||!l.tile.effects)continue;const a=l.tile.effects[e];if(await this._fire(a,t,i,s,l)){r=!0;break}}return r}activateSync(e,t,i,s,l={}){l.cell=this;let r=!1;if(void 0!==l.depth){const a=l.tile=this.depthTile(l.depth);if(a&&a.effects){const n=a.effects[e];r=this._fireSync(n,t,i,s,l)}}else for(l.tile of this.tiles){if(!l.tile||!l.tile.effects)continue;const a=l.tile.effects[e];if(this._fireSync(a,t,i,s,l)){r=!0;break}}return r}async _fire(e,t,i,s,l){"string"==typeof e&&(e=P[e]);let r=!1;return e&&(r=await B(e,t,i,s,l)),r}_fireSync(e,t,i,s,l){"string"==typeof e&&(e=P[e]);let r=!1;return e&&(r=v(e,t,i,s,l)),r}hasEffect(e){for(let t of this.tiles)if(t&&t.hasEffect(e))return!0;return!1}hasItem(){return this.hasCellFlag(S.HAS_ITEM)}get item(){return this._item}set item(e){this._item=e,e?this.setCellFlag(S.HAS_ITEM):this.clearCellFlag(S.HAS_ITEM),this.needsRedraw=!0}hasActor(){return this.hasCellFlag(S.HAS_ACTOR)}hasPlayer(){return this.hasCellFlag(S.HAS_PLAYER)}get actor(){return this._actor}set actor(e){this._actor=e,e?this.setCellFlag(S.HAS_ACTOR):this.clearCellFlag(S.HAS_ACTOR),this.needsRedraw=!0}getDescription(){return this.highestPriorityTile().description}getFlavor(){return this.highestPriorityTile().flavor}getName(e={}){return this.highestPriorityTile().getName(e)}dump(){var e,t,i,s;return(null===(t=null===(e=this._actor)||void 0===e?void 0:e.sprite)||void 0===t?void 0:t.ch)?this._actor.sprite.ch:(null===(s=null===(i=this._item)||void 0===i?void 0:i.sprite)||void 0===s?void 0:s.ch)?this._item.sprite.ch:this.highestPriorityTile().sprite.ch||" "}}class Z{constructor(e,t="layer"){this.map=e,this.depth=-1,this.properties={},this.name=t}copy(e){}async tick(e){return!1}}class ee extends Z{constructor(e,t="actor"){super(e,t)}add(e,t,i,l){const r=this.map.cell(e,t);return!i.forbidsCell(r)&&(!!s.utils.addToChain(r,"actor",i)&&(i.isPlayer()&&r.setCellFlag(S.HAS_PLAYER),i.x=e,i.y=t,!0))}remove(e){const t=this.map.cell(e.x,e.y);return!!s.utils.removeFromChain(t,"actor",e)&&(e.isPlayer()&&t.clearCellFlag(S.HAS_PLAYER),!0)}putAppearance(e,t,i){const s=this.map.cell(t,i);s.actor&&e.drawSprite(s.actor.sprite)}}class te extends Z{constructor(e,t="item"){super(e,t)}add(e,t,i,l){const r=this.map.cell(e,t);return!i.forbidsCell(r)&&(!!s.utils.addToChain(r,"item",i)&&(i.x=e,i.y=t,!0))}remove(e){const t=this.map.cell(e.x,e.y);return!!s.utils.removeFromChain(t,"item",e)}putAppearance(e,t,i){const s=this.map.cell(t,i);s.item&&e.drawSprite(s.item.sprite)}}class ie extends Z{constructor(e,t="tile"){super(e,t)}set(e,t,i,s={}){const l=this.map.cell(e,t),r=l.depthTile(i.depth)||x.NULL;if(!s.superpriority&&r.priority>i.priority)return!1;if(l.blocksLayer(i.depth))return!1;if(s.blockedByItems&&l.hasItem())return!1;if(s.blockedByActors&&l.hasActor())return!1;if(s.blockedByOtherLayers&&l.highestPriority()>i.priority)return!1;if(i.depth>n.GROUND&&i.groundTile){const s=l.depthTile(n.GROUND);s&&s!==x.NULL||this.set(e,t,X(i.groundTile))}return!!l.setTile(i)&&(s.machine&&(l.machineId=s.machine),r.light!==i.light&&(this.map.light.glowLightChanged=!0),i.hasTileFlag(E.T_IS_FIRE)&&l.setCellFlag(S.CAUGHT_FIRE_THIS_TURN),!0)}clear(e,t){return this.map.cell(e,t).clearDepth(this.depth)}async tick(e){for(let e=0;e<this.map.width;++e)for(let t=0;t<this.map.height;++t){const i=this.map.cell(e,t);!i.hasCellFlag(S.HAS_ANY_ACTOR|S.HAS_ITEM)&&i.hasCellFlag(S.PRESSURE_PLATE_DEPRESSED)&&i.clearCellFlag(S.PRESSURE_PLATE_DEPRESSED),i.hasEffect("noKey")&&!i.hasKey()&&await i.activate("noKey",this.map,e,t)}return!0}putAppearance(e,t,i){const s=this.map.cell(t,i).depthTile(this.depth);s&&s!==x.NULL&&e.drawSprite(s.sprite)}}class se{constructor(){this.chokeCount=0,this.machineId=0,this.flags={cell:0,item:0,actor:0,tile:0,tileMech:0,object:0},this.blocks={vision:!1,effects:!1,move:!1,pathing:!1},this._tile=x.NULL,this._item=null,this._actor=null,this._hasKey=!1,this.snapshot=new s.sprite.Mixer}clear(){this.snapshot.blackOut(),this._item=null,this._actor=null,this._tile=x.NULL,this.flags.cell=0,this.flags.object=0,this.flags.tile=0,this.flags.tileMech=0,this.blocks.effects=!1,this.blocks.move=!1,this.blocks.pathing=!1,this.blocks.vision=!1,this._hasKey=!1,this.machineId=0,this.chokeCount=0}store(e){this._item=null,e.hasItem()&&(this._item=e.item),this._actor=null,e.hasActor()&&(this._actor=e.actor),this._tile=e.tile,this.flags.cell=e.cellFlags(),this.flags.tile=e.tileFlags(),this.flags.tileMech=e.tileMechFlags(),this.flags.object=e.objectFlags(),this.flags.item=e.itemFlags(),this.flags.actor=e.actorFlags(),this.blocks.effects=e.blocksEffects(),this.blocks.move=e.blocksMove(),this.blocks.pathing=e.blocksPathing(),this.blocks.vision=e.blocksVision(),this._hasKey=e.hasKey(),this.chokeCount=e.chokeCount,this.machineId=e.machineId}getSnapshot(e){e.copy(this.snapshot)}putSnapshot(e){this.snapshot.copy(e)}hasCellFlag(e){return!!(this.flags.cell&e)}hasTileFlag(e){return!!(this.flags.tile&e)}hasAllTileFlags(e){return(this.flags.tile&e)==e}hasObjectFlag(e){return!!(this.flags.object&e)}hasAllObjectFlags(e){return(this.flags.object&e)==e}hasTileMechFlag(e){return!!(this.flags.tileMech&e)}cellFlags(){return this.flags.cell}objectFlags(){return this.flags.object}tileFlags(){return this.flags.tile}tileMechFlags(){return this.flags.tileMech}itemFlags(){return this.flags.item}actorFlags(){return this.flags.actor}blocksVision(){return this.blocks.vision}blocksPathing(){return this.blocks.pathing}blocksMove(){return this.blocks.move}blocksEffects(){return this.blocks.effects}isWall(){return this.blocksVision()&&this.blocksMove()}isStairs(){return this.hasTileFlag(E.T_HAS_STAIRS)}hasKey(){return this._hasKey}get tile(){return this._tile}hasTile(e){return e instanceof V||(e=X(e)),this._tile===e}hasItem(){return!!this._item}get item(){return this._item}hasActor(){return!!this._actor}hasPlayer(){return!!(this.flags.cell&S.HAS_PLAYER)}get actor(){return this._actor}getDescription(){throw new Error("Method not implemented.")}getFlavor(){throw new Error("Method not implemented.")}getName(e){throw new Error("Method not implemented.")}}const le=n,re=r,ae=E,ne=T,he=S;class ce extends ie{constructor(e,t="tile"){super(e,t)}async tick(e){for(let e=0;e<this.map.width;++e)for(let t=0;t<this.map.height;++t){this.map.cell(e,t).clearCellFlag(he.CAUGHT_FIRE_THIS_TURN)}for(let e=0;e<this.map.width;++e)for(let t=0;t<this.map.height;++t){const i=this.map.cell(e,t);if(i.hasTileFlag(ae.T_IS_FIRE)&&!(i.flags.cell&he.CAUGHT_FIRE_THIS_TURN)){await this.exposeToFire(e,t,!1);for(let i=0;i<4;++i){const l=s.utils.DIRS[i];await this.exposeToFire(e+l[0],t+l[1])}}}return!0}async exposeToFire(e,t,i=!1){let l=0,r=0,a=0,n=!1,h=!1;const c=this.map.cell(e,t);if(!c.hasTileFlag(ae.T_IS_FLAMMABLE))return!1;if(c.eachTile((e=>{e.hasTileFlag(ae.T_EXTINGUISHES_FIRE)&&e.priority>r&&(r=e.priority)})),c.eachTile((e=>{if(e.flags.tile&ae.T_IS_FLAMMABLE&&(e.depth===le.GAS||e.priority>=r)){const t=D(e.effects.fire);t&&t.chance>l&&(l=t.chance)}})),i||l&&s.random.chance(l,1e4)){n=!0,c.hasTileMechFlag(ne.TM_EXPLOSIVE_PROMOTE)&&(s.utils.eachNeighbor(e,t,((e,t)=>{const i=this.map.cell(e,t);(i.hasObjectFlag(re.L_BLOCKS_GAS)||i.hasTileFlag(ae.T_IS_FIRE)||i.hasTileMechFlag(ne.TM_EXPLOSIVE_PROMOTE))&&++a})),a>=8&&(h=!0));let i="fire";h&&c.hasEffect("explode")&&(i="explode"),await c.activate(i,this.map,e,t,{force:!0}),c.needsRedraw=!0}return n}}class _e extends ie{constructor(e,t="gas"){super(e,t),this.needsUpdate=!1,this.volume=s.grid.alloc(e.width,e.height,0)}set(e,t,i,s={}){if(!s.volume)return!1;return this.map.cell(e,t).depthTile(i.depth)===i?(this.volume[e][t]+=s.volume,!0):!!super.set(e,t,i,s)&&(this.volume[e][t]=s.volume,this.needsUpdate=!0,!0)}clear(e,t){return!!this.map.cell(e,t).clearDepth(this.depth)&&(this.volume[e][t]=0,!0)}copy(e){this.volume.copy(e.volume)}async tick(e){if(!this.needsUpdate)return!1;this.needsUpdate=!1;const t=this.volume;return this.volume=s.grid.alloc(this.map.width,this.map.height),this.dissipate(t),this.spread(t),s.grid.free(t),!0}dissipate(e){e.update(((e,t,i)=>{if(!e)return 0;const s=this.map.cell(t,i).depthTile(this.depth);if(s&&s.dissipate){let t=Math.max(.5,e*s.dissipate/1e4);e=Math.max(0,e-t)}return e?this.needsUpdate=!0:this.clear(t,i),e}))}calcOpacity(e){return Math.floor(10*Math.min(e,10))}updateCellVolume(e,t,i){let s=0,l=0,a=0;const n=this.map.cell(e,t);let h=n.depthTile(this.depth),c=h;if(n.hasObjectFlag(r.L_BLOCKS_GAS))return this.volume[e][t]=0,void(i[e][t]&&this.clear(e,t));for(let h=Math.max(0,e-1);h<Math.min(e+2,i.width);++h)for(let e=Math.max(0,t-1);e<Math.min(t+2,i.height);++e){const t=i[h][e];n.hasObjectFlag(r.L_BLOCKS_GAS)||(++l,t>a&&(a=t,c=this.map.cell(h,e).depthTile(this.depth))),s+=t}const _=Math.floor(10*s/l)/10;this.volume[e][t]=_,_>0&&c&&(h&&h===c||n.setTile(c)),_>0&&(n.needsRedraw=!0)}spread(e){for(let t=0;t<e.width;++t)for(let i=0;i<e.height;++i)this.updateCellVolume(t,i,e)}putAppearance(e,t,i){const s=this.volume[t][i];if(!s)return;const l=this.map.cell(t,i).depthTile(this.depth);if(l){const t=this.calcOpacity(s);e.drawSprite(l.sprite,t)}}}class oe{constructor(e,t,i={}){this.width=e,this.height=t,this.flags={map:0},this.layers=[],this.cells=s.grid.make(e,t,(()=>new $)),this.memory=s.grid.make(e,t,(()=>new se)),this.light=new s.light.LightSystem(this,i),this.fov=new s.fov.FovSystem(this,i),this.properties={},this.initLayers()}cellInfo(e,t,i=!1){return i?this.memory[e][t]:this.cell(e,t)}initLayers(){this.addLayer(n.GROUND,new ie(this,"ground")),this.addLayer(n.SURFACE,new ce(this,"surface")),this.addLayer(n.GAS,new _e(this,"gas")),this.addLayer(n.ITEM,new te(this,"item")),this.addLayer(n.ACTOR,new ee(this,"actor"))}addLayer(e,t){"number"!=typeof e&&(e=n[e]),t.depth=e,this.layers[e]=t}removeLayer(e){if("number"!=typeof e&&(e=n[e]),!e)throw new Error("Cannot remove layer with depth=0.");delete this.layers[e]}getLayer(e){return"number"!=typeof e&&(e=n[e]),this.layers[e]||null}hasXY(e,t){return this.cells.hasXY(e,t)}isBoundaryXY(e,t){return 0==e||0==t||e==this.width-1||t==this.height-1}cell(e,t){return this.cells[e][t]}get(e,t){return this.cells.get(e,t)}eachCell(e){this.cells.forEach(((t,i,s)=>e(t,i,s,this)))}drawInto(e,t={}){const i=e instanceof s.canvas.Canvas?e.buffer:e;"boolean"==typeof t&&(t={force:t});const l=new s.sprite.Mixer;for(let e=0;e<i.width;++e)for(let t=0;t<i.height;++t)this.getAppearanceAt(e,t,l),i.drawSprite(e,t,l)}itemAt(e,t){return this.cell(e,t).item}eachItem(e){this.cells.forEach((t=>{s.utils.eachChain(t.item,e)}))}addItem(e,t,i){return this.layers[i.depth].add(e,t,i)}removeItem(e){return this.layers[e.depth].remove(e)}moveItem(e,t,i){const s=this.layers[e.depth];return!!s.remove(e)&&s.add(t,i,e)}hasPlayer(e,t){return this.cell(e,t).hasPlayer()}actorAt(e,t){return this.cell(e,t).actor}eachActor(e){this.cells.forEach((t=>{s.utils.eachChain(t.actor,e)}))}addActor(e,t,i){return this.layers[i.depth].add(e,t,i)}removeActor(e){return this.layers[e.depth].remove(e)}moveActor(e,t,i){const s=this.layers[e.depth];return!!s.remove(e)&&s.add(t,i,e)}isVisible(e,t){return this.fov.isAnyKindOfVisible(e,t)}count(e){return this.cells.count(((t,i,s)=>e(t,i,s,this)))}dump(e,t=console.log){this.cells.dump(e||(e=>e.dump()),t)}hasMapFlag(e){return!!(this.flags.map&e)}setMapFlag(e){this.flags.map|=e}clearMapFlag(e){this.flags.map&=~e}setCellFlag(e,t,i){this.cell(e,t).setCellFlag(i)}clearCellFlag(e,t,i){this.cell(e,t).clearCellFlag(i)}fill(e,t){let i,s;for(e=X(e),t=X(t||e),i=0;i<this.width;++i)for(s=0;s<this.height;++s){const l=this.cell(i,s);l.clear(),l.setTile(this.isBoundaryXY(i,s)?t:e)}}hasTile(e,t,i,s=!1){return this.cellInfo(e,t,s).hasTile(i)}setTile(e,t,i,s){if(!(i instanceof V||(i=X(i))))return!1;!0===s&&(s={superpriority:!0});const l=i.depth||0,r=this.layers[l]||this.layers[0];return r instanceof ie&&r.set(e,t,i,s)}async tick(e){let t=await this.fireAll("tick");for(let i of this.layers)i&&await i.tick(e)&&(t=!0);return t}copy(e){if(this.constructor!==e.constructor)throw new Error("Maps must be same type to copy.");if(this.width!==e.width||this.height!==e.height)throw new Error("Maps must be same size to copy");this.cells.forEach(((t,i,s)=>{t.copy(e.cells[i][s])})),this.layers.forEach(((t,i)=>{t.copy(e.layers[i])})),this.flags.map=e.flags.map,this.light.setAmbient(e.light.getAmbient())}clone(){const e=new this.constructor(this.width,this.height);return e.copy(this),e}async fire(e,t,i,s={}){return this.cell(t,i).activate(e,this,t,i,s)}fireSync(e,t,i,s={}){return this.cell(t,i).activateSync(e,this,t,i,s)}async fireAll(e,t={}){const i=s.grid.alloc(this.width,this.height);return this.cells.forEach(((t,l,a)=>{t.clearCellFlag(S.EVENT_FIRED_THIS_TURN|S.EVENT_PROTECTED),t.eachTile((n=>{const h=n.effects[e];if(!h)return;const c=D(h);if(!c)return;let _=0;c.chance<0?(_=0,s.utils.eachNeighbor(l,a,((e,i)=>{const s=this.cell(e,i);s.hasObjectFlag(r.L_BLOCKS_EFFECTS)||s.depthTile(n.depth)==t.depthTile(n.depth)||s.hasCellFlag(S.CAUGHT_FIRE_THIS_TURN)||(_+=-1*c.chance)}),!0)):_=c.chance||1e4,!t.hasCellFlag(S.CAUGHT_FIRE_THIS_TURN)&&s.random.chance(_,1e4)&&(i[l][a]|=s.flag.fl(n.depth))}))})),t.force=!0,await i.forEachAsync((async(t,i,l)=>{if(!t)return;const r=this.cell(i,l);if(!r.hasCellFlag(S.EVENT_FIRED_THIS_TURN))for(let a=0;a<=n.GAS;++a)t&s.flag.fl(a)&&await r.activate(e,this,i,l,{force:!0,depth:a})})),s.grid.free(i),!1}fireAllSync(e,t={}){const i=s.grid.alloc(this.width,this.height);return this.cells.forEach(((t,l,a)=>{t.clearCellFlag(S.EVENT_FIRED_THIS_TURN|S.EVENT_PROTECTED),t.eachTile((n=>{const h=n.effects[e];if(!h)return;const c=D(h);if(!c)return;let _=0;c.chance<0?(_=0,s.utils.eachNeighbor(l,a,((e,i)=>{const s=this.cell(e,i);s.hasObjectFlag(r.L_BLOCKS_EFFECTS)||s.depthTile(n.depth)==t.depthTile(n.depth)||s.hasCellFlag(S.CAUGHT_FIRE_THIS_TURN)||(_+=-1*c.chance)}),!0)):_=c.chance||1e4,!t.hasCellFlag(S.CAUGHT_FIRE_THIS_TURN)&&s.random.chance(_,1e4)&&(i[l][a]|=s.flag.fl(n.depth))}))})),t.force=!0,i.forEach(((t,i,l)=>{if(!t)return;const r=this.cell(i,l);if(!r.hasCellFlag(S.EVENT_FIRED_THIS_TURN))for(let a=0;a<=n.GAS;++a)t&s.flag.fl(a)&&r.activate(e,this,i,l,{force:!0,depth:a})})),s.grid.free(i),!1}async activateMachine(e,t,i,s={}){let l=!1;s.originX=t,s.originY=i;for(let t=0;t<this.width;++t)for(let i=0;i<this.height;++i){const r=this.cells[t][i];r.machineId===e&&(r.hasEffect("machine")&&(l=await r.activate("machine",this,t,i,s)||l))}return l}activateMachineSync(e,t,i,s={}){let l=!1;s.originX=t,s.originY=i;for(let t=0;t<this.width;++t)for(let i=0;i<this.height;++i){const r=this.cells[t][i];r.machineId===e&&(r.hasEffect("machine")&&(l=r.activateSync("machine",this,t,i,s)||l))}return l}getAppearanceAt(e,t,i){i.blackOut();const l=this.cell(e,t),a=this.fov.isAnyKindOfVisible(e,t);if(l.needsRedraw&&a?(this.layers.forEach((s=>s.putAppearance(i,e,t))),i.dances?l.setCellFlag(S.COLORS_DANCE):l.clearCellFlag(S.COLORS_DANCE),i.bake(),this.memory[e][t].putSnapshot(i),l.needsRedraw=!1):this.memory[e][t].getSnapshot(i),a){const s=this.light.getLight(e,t);i.multiply(s)}else this.fov.isRevealed(e,t)?i.scale(50):i.blackOut();l.hasObjectFlag(r.L_VISUALLY_DISTINCT)&&s.color.separate(i.fg,i.bg)}hasActor(e,t){return this.cell(e,t).hasActor()}eachGlowLight(e){this.cells.forEach(((t,i,s)=>{t.eachGlowLight((t=>e(i,s,t)))}))}eachDynamicLight(e){}eachViewport(e){}lightingChanged(){return this.light.changed}hasVisibleLight(e,t){return!this.light.isDark(e,t)}blocksVision(e,t){return this.cell(e,t).blocksVision()}onCellRevealed(e,t){}redrawCell(e,t,i){i&&this.clearMemory(e,t),this.cells[e][t].needsRedraw=!0}clearMemory(e,t){this.memory[e][t].clear()}storeMemory(e,t){const i=this.cell(e,t);this.memory[e][t].store(i)}}function Ee(e,t,i={},s){"string"==typeof i&&(i={tile:i}),s&&(i.boundary=s),!0===i.tile&&(i.tile="FLOOR"),!0===i.boundary&&(i.boundary="WALL");const l=new oe(e,t,i);return i.tile&&l.fill(i.tile,i.boundary),l.light.update(),l}function fe(e,t){const i=s.grid.alloc(e.width,e.height),l=s.grid.alloc(e.width,e.height);for(let t=0;t<e.width;t++)for(let s=0;s<e.height;s++){const l=e.cell(t,s);!l.blocksPathing()&&!l.blocksMove()||l.hasObjectFlag(r.L_SECRETLY_PASSABLE)?i[t][s]=1:i[t][s]=0}let a;for(let t=1;t<i.width-1;t++)for(let l=1;l<i.height-1;l++)if(e.cell(t,l).flags.cell&=~S.IS_CHOKEPOINT,i[t][l]&&!(e.cell(t,l).flags.cell&S.IS_IN_LOOP)){a=0;for(let r=0;r<8;r++){const n=t+s.utils.CLOCK_DIRS[(r+7)%8][0],h=l+s.utils.CLOCK_DIRS[(r+7)%8][1],c=t+s.utils.CLOCK_DIRS[r][0],_=l+s.utils.CLOCK_DIRS[r][1];if((e.hasXY(c,_)&&i[c][_])!=(e.hasXY(n,h)&&i[n][h])&&++a>2){(i[t-1][l]||i[t+1][l])&&(i[t][l-1]||i[t][l+1])||(e.cell(t,l).flags.cell|=S.IS_CHOKEPOINT);break}}}if(t){for(let t=0;t<e.width;t++)for(let i=0;i<e.height;i++)e.cell(t,i).chokeCount=3e4;for(let t=0;t<e.width;t++)for(let r=0;r<e.height;r++){const a=e.cell(t,r);if(i[t][r]&&a.flags.cell&S.IS_CHOKEPOINT)for(let n=0;n<4;n++){const h=t+s.utils.DIRS[n][0],c=r+s.utils.DIRS[n][1];if(e.hasXY(h,c)&&i[h][c]&&!(e.cell(h,c).flags.cell&S.IS_CHOKEPOINT)){l.fill(0),i[t][r]=0;let s=Te(e,l,i,h,c);if(i[t][r]=1,s>=4){for(let t=0;t<l.width;t++)for(let i=0;i<l.height;i++)l[t][i]&&s<e.cell(t,i).chokeCount&&(e.cell(t,i).chokeCount=s,e.cell(t,i).flags.cell&=~S.IS_GATE_SITE);s<a.chokeCount&&(a.chokeCount=s,a.flags.cell|=S.IS_GATE_SITE)}}}}}s.grid.free(i),s.grid.free(l)}function Te(e,t,i,l,r){let a=2==i[l][r]?5e3:1;e.cell(l,r).flags.cell&S.IS_IN_AREA_MACHINE&&(a=1e4),t[l][r]=1;for(let n=0;n<4;n++){const h=l+s.utils.DIRS[n][0],c=r+s.utils.DIRS[n][1];e.hasXY(h,c)&&i[h][c]&&!t[h][c]&&(a+=Te(e,t,i,h,c))}return Math.min(a,1e4)}function ue(e){e.eachCell(Se),e.eachCell(ge),Ae(e)}function Se(e,t,i,s){!e.blocksPathing()&&!e.blocksMove()||e.hasObjectFlag(r.L_SECRETLY_PASSABLE)?e.flags.cell|=S.IS_IN_LOOP:e.flags.cell&=~S.IS_IN_LOOP}function ge(e,t,i,l){let r,a,n,h,c,_,o,E;if(!(e&&e.flags.cell&S.IS_IN_LOOP))return!1;for(c=0;c<8;c++){if(a=t+s.utils.CLOCK_DIRS[c][0],n=i+s.utils.CLOCK_DIRS[c][1],!l.hasXY(a,n))continue;const e=l.get(a,n);if(!(e&&e.flags.cell&S.IS_IN_LOOP))break}if(8==c)return!1;for(_=o=E=0,r=!1,h=c;h<c+8;h++){if(a=t+s.utils.CLOCK_DIRS[h%8][0],n=i+s.utils.CLOCK_DIRS[h%8][1],!l.hasXY(a,n))continue;const e=l.get(a,n);if(e&&e.flags.cell&S.IS_IN_LOOP){if(E++,!r){if(_>0)return!1;_++,r=!0}}else r&&(E>o&&(o=E),E=0,r=!1)}if(r&&E>o&&(o=E),1==_&&o<=4){for(e.flags.cell&=~S.IS_IN_LOOP,h=0;h<8;h++){const e=t+s.utils.CLOCK_DIRS[h][0],r=i+s.utils.CLOCK_DIRS[h][1];if(l.hasXY(e,r)){ge(l.cell(e,r),e,r,l)}}return!0}return!1}function Le(e,t){for(let i=0;i<e.width;++i)for(let s=0;s<e.height;++s){if(e.cell(i,s).flags.cell&S.IS_IN_LOOP)t[i][s]=1;else if(i>0&&s>0){const l=e.cell(i,s-1),r=e.cell(i-1,s);l.flags.cell&S.IS_IN_LOOP&&r.flags.cell&S.IS_IN_LOOP&&(t[i][s]=1)}}}function Ae(e){const t=s.grid.alloc(e.width,e.height);let i;Le(e,t);for(let l=0;l<t.width;l++)for(let r=0;r<t.height;r++){if(e.cell(l,r).flags.cell&S.IS_IN_LOOP){i=!1;for(let a=0;a<8;a++){let n=l+s.utils.CLOCK_DIRS[a][0],h=r+s.utils.CLOCK_DIRS[a][1];if(e.hasXY(n,h)&&!t[n][h]&&!(e.cell(n,h).flags.cell&S.IS_IN_LOOP)){i=!0;break}}i||(t[l][r]=1,e.cell(l,r).flags.cell&=~S.IS_IN_LOOP)}}s.grid.free(t)}class Ie{make(e,t){var i,l,r,a,n,h,c;if(!e.tile)return!0;let _=e.tile;if("string"==typeof _){const e=_.split(/[,|]/).map((e=>e.trim()));_={tile:e[0],grow:Number.parseInt(e[1]||"0"),decrement:Number.parseInt(e[2]||"0")}}const o={grow:null!==(l=null!==(i=_.grow)&&void 0!==i?i:_.spread)&&void 0!==l?l:0,decrement:null!==(r=_.decrement)&&void 0!==r?r:0,flags:s.flag.from(y,_.flags),volume:null!==(a=_.volume)&&void 0!==a?a:0,next:null!==(n=_.next)&&void 0!==n?n:null},E=null!==(h=_.tile)&&void 0!==h?h:_.id;if("string"!=typeof E)throw new Error("Invalid tile spawn config: "+E);if(o.tile=E,!o.tile)throw new Error("Must have tile.");const f=null!==(c=_.matchTile)&&void 0!==c?c:_.match;if("string"==typeof f)o.matchTile=f;else if(f)throw new Error("Invalid tile spawn match tile: "+_.matchTile);return t.tile=o,!0}async fire(e,t,i,s,l){let r=!1;return this.fireSync(e,t,i,s,l)&&(r=!0),r}fireSync(e,t,i,s,l){if(!e.tile)return!1;const r=e.tile.tile,a=x[r]||null;if(!a)throw new Error("Failed to find tile for effect: "+r);const n=!!(e.flags&y.E_ABORT_IF_BLOCKS_MAP),h=!(!n||e.flags&y.E_PERMIT_BLOCKING||!(a.blocksPathing()||e.flags&y.E_TREAT_AS_BLOCKING));let c=!1;if(c=de(e,t,i,s,l),!c)return!1;if(n&&h&&this.mapDisruptedBy(t,e.grid))return!1;e.flags&y.E_EVACUATE_CREATURES&&pe(t,l.grid)&&(c=!0),e.flags&y.E_EVACUATE_ITEMS&&me(t,l.grid)&&(c=!0),e.flags&y.E_CLEAR_CELL&&Ce(t,l.grid,e.flags)&&(c=!0);return Re(e.flags,l.grid,t,a,e.tile.volume,l.machine)}mapDisruptedBy(e,t,i=0,l=0){const r=s.grid.alloc(e.width,e.height);let a=!1;s.utils.forRect(e.width,e.height,((s,n)=>{const h=s+i,c=n+l;t.get(h,c)?e.cellInfo(s,n).isStairs()&&(a=!0):e.cellInfo(s,n).blocksMove()||(r[s][n]=1)}));let n=!0;for(let e=0;e<r.width&&!a;++e)for(let t=0;t<r.height&&!a;++t)1==r[e][t]&&(n?(r.floodFill(e,t,1,2),n=!1):a=!0);return s.grid.free(r),a}}function Re(e,t,i,s,l=0,r){let a,n,h;h=!1;const c=!!(e&y.E_BLOCKED_BY_OTHER_LAYERS),_=!!(e&y.E_SUPERPRIORITY),o=!!(e&y.E_BLOCKED_BY_ACTORS),E=!!(e&y.E_BLOCKED_BY_ITEMS);for(l=l||0,a=0;a<t.width;a++)for(n=0;n<t.height;n++){if(!t[a][n])continue;t[a][n]=0;const f=i.cell(a,n);f.hasTile(s)||i.setTile(a,n,s,{volume:l,superpriority:_,blockedByOtherLayers:c,blockedByActors:o,blockedByItems:E,machine:r})&&(t[a][n]=1,f.flags.cell|=S.EVENT_FIRED_THIS_TURN,e&y.E_PROTECTED&&(f.flags.cell|=S.EVENT_PROTECTED),h=!0)}return h&&i.setMapFlag(L.MAP_CHANGED),h}function Oe(e,t,i,l,r){if(!t.hasXY(i,l))return!1;const a=t.cell(i,l);if(a.hasCellFlag(S.EVENT_PROTECTED))return!1;if(a.blocksEffects()&&!e.tile.matchTile&&!r)return!1;if(e.flags&y.E_BUILD_IN_WALLS){if(!t.cellInfo(i,l).isWall())return!1}else if(e.flags&y.E_MUST_TOUCH_WALLS){let e=!1;if(s.utils.eachNeighbor(i,l,((i,s)=>{t.cellInfo(i,s).isWall()&&(e=!0)}),!0),!e)return!1}else if(e.flags&y.E_NO_TOUCH_WALLS){let e=!0;if(t.cellInfo(i,l).isWall())return!1;if(s.utils.eachNeighbor(i,l,((i,s)=>{t.cellInfo(i,s).isWall()&&(e=!1)}),!0),!e)return!1}return!(e.tile.matchTile&&!r&&!a.hasTile(e.tile.matchTile))}function de(e,t,i,l,r){let a,n,h,c,_,o,E;const f=e.tile;let T=f.grow||0,u=f.decrement||0;const S=r.grid;if(S.fill(0),!Oe(e,t,i,l,!0))return!1;S[i][l]=c=1;let g=1;if(T)for(E=!0,T>=100&&(u=u||100),u<=0&&(u=T);E&&T>0;){for(E=!1,c++,a=0;a<t.width;a++)for(n=0;n<t.height;n++)if(S[a][n]==c-1)for(h=0;h<4;h++)_=a+s.utils.DIRS[h][0],o=n+s.utils.DIRS[h][1],S.hasXY(_,o)&&!S[_][o]&&s.random.chance(T)&&Oe(e,t,_,o,!1)&&(S[_][o]=c,E=!0,++g);T-=u}return g>0}function Ce(e,t,i=0){let s=!1;const l=(i&y.E_CLEAR_CELL)===y.E_CLEAR_CELL;return t.forEach(((t,r,a)=>{if(!t)return;const h=e.cell(r,a);l?h.clear():(i&y.E_CLEAR_GAS&&h.clearDepth(n.GAS),i&y.E_CLEAR_LIQUID&&h.clearDepth(n.LIQUID),i&y.E_CLEAR_SURFACE&&h.clearDepth(n.SURFACE),i&y.E_CLEAR_GROUND&&h.clearDepth(n.GROUND)),s=!0})),s}function pe(e,t){let i=0,l=0,r=!1;for(i=0;i<e.width;i++)for(l=0;l<e.height;l++){if(!t[i][l])continue;const a=e.cell(i,l);a.hasActor()&&s.utils.eachChain(a.actor,(a=>{if(!(a instanceof A))return;const n=a,h=s.random.matchingLocNear(i,l,((i,s)=>{if(!e.hasXY(i,s))return!1;if(t[i][s])return!1;const l=e.cell(i,s);return!n.forbidsCell(l)}));h&&h[0]>=0&&h[1]>=0&&(e.moveActor(n,h[0],h[1]),r=!0)}))}return r}function me(e,t){let i=!1;return t.forEach(((l,r,a)=>{if(!l)return;const n=e.cell(r,a);n.hasItem()&&s.utils.eachChain(n.item,(l=>{if(!(l instanceof p))return;const n=l,h=s.random.matchingLocNear(r,a,((i,s)=>{if(!e.hasXY(i,s))return!1;if(t[i][s])return!1;const l=e.cell(i,s);return!n.forbidsCell(l)}));h&&h[0]>=0&&h[1]>=0&&(e.moveItem(n,h[0],h[1]),i=!0)}))})),i}U("tile",new Ie);U("clear",new class{make(e,t){if(!e.clear)return!0;let i=e.clear,s=0;if("string"==typeof i&&(i=i.split(/[,|]/).map((e=>e.trim()))),!0===i)s=n.ALL_LAYERS;else if("number"==typeof i)s=i;else{if(!Array.isArray(i))throw new Error("clear effect must have number or string config.");s=i.reduce(((e,t)=>{if("number"==typeof t)return e|t;return e|(n[t]||0)}),0)}return t.clear=s,s>0}fire(e,t,i,s,l){return this.fireSync(e,t,i,s,l)}fireSync(e,t,i,s,l){if(!e.clear)return!1;if(!t)return!1;return t.cell(i,s).clearDepth(e.clear)}});var Ne={__proto__:null,Cell:$,Map:oe,make:Ee,from:function(e,t,i={}){let s,l=0,r=0;return"string"==typeof e&&(e=e.split("\n")),!function(e){return Array.isArray(e)&&"string"==typeof e[0]}(e)?(l=e.height,r=e.width,s=Ee(r,l,i),e.forEach(((e,i,l)=>{const r=t[e]||"FLOOR";s.setTile(i,l,r)}))):(l=e.length,r=e.reduce(((e,t)=>Math.max(e,t.length)),0),s=Ee(r,l,i),e.forEach(((e,i)=>{for(let l=0;l<r;++l){const r=e[l]||".",a=t[r]||"FLOOR";s.setTile(l,i,a)}}))),s.light.update(),s},analyze:function(e,t=!0){ue(e),fe(e,t)},updateChokepoints:fe,floodFillCount:Te,updateLoopiness:ue,resetLoopiness:Se,checkLoopiness:ge,fillInnerLoopGrid:Le,cleanLoopiness:Ae,SpawnEffect:Ie,spawnTiles:Re,computeSpawnMap:de,clearCells:Ce,evacuateCreatures:pe,evacuateItems:me,CellMemory:se,MapLayer:Z,ActorLayer:ee,ItemLayer:te,TileLayer:ie,GasLayer:_e,FireLayer:ce};e.actor=I,e.effect=Y,e.gameObject=h,e.item=m,e.map=Ne,e.tile=z,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=gw-map.min.js.map
