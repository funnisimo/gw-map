!function(_,T){"object"==typeof exports&&"undefined"!=typeof module?T(exports,require("gw-utils")):"function"==typeof define&&define.amd?define(["exports","gw-utils"],T):T((_="undefined"!=typeof globalThis?globalThis:_||self).GW=_.GW||{},_.GW)}(this,(function(_,T){"use strict";var E;!function(_){_[_.GROUND=0]="GROUND",_[_.SURFACE=1]="SURFACE",_[_.LIQUID=2]="LIQUID",_[_.GAS=3]="GAS",_[_.ITEM=4]="ITEM",_[_.ACTOR=5]="ACTOR",_[_.PLAYER=6]="PLAYER",_[_.FX=7]="FX",_[_.UI=8]="UI"}(E||(E={}));const S=T.flag.fl;var A,I,R,O,L,N;!function(_){_[_.DFF_SUBSEQ_ALWAYS=S(0)]="DFF_SUBSEQ_ALWAYS",_[_.DFF_SUBSEQ_EVERYWHERE=S(1)]="DFF_SUBSEQ_EVERYWHERE",_[_.DFF_TREAT_AS_BLOCKING=S(2)]="DFF_TREAT_AS_BLOCKING",_[_.DFF_PERMIT_BLOCKING=S(3)]="DFF_PERMIT_BLOCKING",_[_.DFF_ACTIVATE_DORMANT_MONSTER=S(4)]="DFF_ACTIVATE_DORMANT_MONSTER",_[_.DFF_BLOCKED_BY_OTHER_LAYERS=S(6)]="DFF_BLOCKED_BY_OTHER_LAYERS",_[_.DFF_SUPERPRIORITY=S(7)]="DFF_SUPERPRIORITY",_[_.DFF_AGGRAVATES_MONSTERS=S(8)]="DFF_AGGRAVATES_MONSTERS",_[_.DFF_RESURRECT_ALLY=S(9)]="DFF_RESURRECT_ALLY",_[_.DFF_EMIT_EVENT=S(10)]="DFF_EMIT_EVENT",_[_.DFF_NO_REDRAW_CELL=S(11)]="DFF_NO_REDRAW_CELL",_[_.DFF_ABORT_IF_BLOCKS_MAP=S(12)]="DFF_ABORT_IF_BLOCKS_MAP",_[_.DFF_BLOCKED_BY_ITEMS=S(13)]="DFF_BLOCKED_BY_ITEMS",_[_.DFF_BLOCKED_BY_ACTORS=S(14)]="DFF_BLOCKED_BY_ACTORS",_[_.DFF_ALWAYS_FIRE=S(15)]="DFF_ALWAYS_FIRE",_[_.DFF_NO_MARK_FIRED=S(16)]="DFF_NO_MARK_FIRED",_[_.DFF_PROTECTED=S(19)]="DFF_PROTECTED",_[_.DFF_SPREAD_CIRCLE=S(20)]="DFF_SPREAD_CIRCLE",_[_.DFF_SPREAD_LINE=S(21)]="DFF_SPREAD_LINE",_[_.DFF_NULL_SURFACE=S(22)]="DFF_NULL_SURFACE",_[_.DFF_NULL_LIQUID=S(23)]="DFF_NULL_LIQUID",_[_.DFF_NULL_GAS=S(24)]="DFF_NULL_GAS",_[_.DFF_EVACUATE_CREATURES=S(25)]="DFF_EVACUATE_CREATURES",_[_.DFF_EVACUATE_ITEMS=S(26)]="DFF_EVACUATE_ITEMS",_[_.DFF_BUILD_IN_WALLS=S(27)]="DFF_BUILD_IN_WALLS",_[_.DFF_MUST_TOUCH_WALLS=S(28)]="DFF_MUST_TOUCH_WALLS",_[_.DFF_NO_TOUCH_WALLS=S(29)]="DFF_NO_TOUCH_WALLS",_[_.DFF_ONLY_IF_EMPTY=_.DFF_BLOCKED_BY_ITEMS|_.DFF_BLOCKED_BY_ACTORS]="DFF_ONLY_IF_EMPTY",_[_.DFF_NULLIFY_CELL=_.DFF_NULL_SURFACE|_.DFF_NULL_LIQUID|_.DFF_NULL_GAS]="DFF_NULLIFY_CELL"}(A||(A={})),function(_){_[_.T_OBSTRUCTS_PASSABILITY=S(0)]="T_OBSTRUCTS_PASSABILITY",_[_.T_OBSTRUCTS_VISION=S(1)]="T_OBSTRUCTS_VISION",_[_.T_OBSTRUCTS_ITEMS=S(2)]="T_OBSTRUCTS_ITEMS",_[_.T_OBSTRUCTS_SURFACE=S(3)]="T_OBSTRUCTS_SURFACE",_[_.T_OBSTRUCTS_GAS=S(4)]="T_OBSTRUCTS_GAS",_[_.T_OBSTRUCTS_LIQUID=S(5)]="T_OBSTRUCTS_LIQUID",_[_.T_OBSTRUCTS_TILE_EFFECTS=S(6)]="T_OBSTRUCTS_TILE_EFFECTS",_[_.T_OBSTRUCTS_DIAGONAL_MOVEMENT=S(7)]="T_OBSTRUCTS_DIAGONAL_MOVEMENT",_[_.T_GAS=S(9)]="T_GAS",_[_.T_BRIDGE=S(10)]="T_BRIDGE",_[_.T_AUTO_DESCENT=S(11)]="T_AUTO_DESCENT",_[_.T_LAVA=S(12)]="T_LAVA",_[_.T_DEEP_WATER=S(13)]="T_DEEP_WATER",_[_.T_SPONTANEOUSLY_IGNITES=S(14)]="T_SPONTANEOUSLY_IGNITES",_[_.T_IS_FLAMMABLE=S(15)]="T_IS_FLAMMABLE",_[_.T_IS_FIRE=S(16)]="T_IS_FIRE",_[_.T_ENTANGLES=S(17)]="T_ENTANGLES",_[_.T_CAUSES_POISON=S(18)]="T_CAUSES_POISON",_[_.T_CAUSES_DAMAGE=S(19)]="T_CAUSES_DAMAGE",_[_.T_CAUSES_NAUSEA=S(20)]="T_CAUSES_NAUSEA",_[_.T_CAUSES_PARALYSIS=S(21)]="T_CAUSES_PARALYSIS",_[_.T_CAUSES_CONFUSION=S(22)]="T_CAUSES_CONFUSION",_[_.T_CAUSES_HEALING=S(23)]="T_CAUSES_HEALING",_[_.T_IS_TRAP=S(24)]="T_IS_TRAP",_[_.T_CAUSES_EXPLOSIVE_DAMAGE=S(25)]="T_CAUSES_EXPLOSIVE_DAMAGE",_[_.T_SACRED=S(26)]="T_SACRED",_[_.T_UP_STAIRS=S(27)]="T_UP_STAIRS",_[_.T_DOWN_STAIRS=S(28)]="T_DOWN_STAIRS",_[_.T_PORTAL=S(29)]="T_PORTAL",_[_.T_IS_DOOR=S(30)]="T_IS_DOOR",_[_.T_HAS_STAIRS=_.T_UP_STAIRS|_.T_DOWN_STAIRS|_.T_PORTAL]="T_HAS_STAIRS",_[_.T_OBSTRUCTS_SCENT=_.T_OBSTRUCTS_PASSABILITY|_.T_OBSTRUCTS_VISION|_.T_AUTO_DESCENT|_.T_LAVA|_.T_DEEP_WATER|_.T_SPONTANEOUSLY_IGNITES|_.T_HAS_STAIRS]="T_OBSTRUCTS_SCENT",_[_.T_PATHING_BLOCKER=_.T_OBSTRUCTS_PASSABILITY|_.T_AUTO_DESCENT|_.T_IS_TRAP|_.T_LAVA|_.T_DEEP_WATER|_.T_IS_FIRE|_.T_SPONTANEOUSLY_IGNITES|_.T_ENTANGLES]="T_PATHING_BLOCKER",_[_.T_DIVIDES_LEVEL=_.T_OBSTRUCTS_PASSABILITY|_.T_AUTO_DESCENT|_.T_IS_TRAP|_.T_LAVA|_.T_DEEP_WATER]="T_DIVIDES_LEVEL",_[_.T_LAKE_PATHING_BLOCKER=_.T_AUTO_DESCENT|_.T_LAVA|_.T_DEEP_WATER|_.T_SPONTANEOUSLY_IGNITES]="T_LAKE_PATHING_BLOCKER",_[_.T_WAYPOINT_BLOCKER=_.T_OBSTRUCTS_PASSABILITY|_.T_AUTO_DESCENT|_.T_IS_TRAP|_.T_LAVA|_.T_DEEP_WATER|_.T_SPONTANEOUSLY_IGNITES]="T_WAYPOINT_BLOCKER",_[_.T_MOVES_ITEMS=_.T_DEEP_WATER|_.T_LAVA]="T_MOVES_ITEMS",_[_.T_CAN_BE_BRIDGED=_.T_AUTO_DESCENT|_.T_LAVA|_.T_DEEP_WATER]="T_CAN_BE_BRIDGED",_[_.T_OBSTRUCTS_EVERYTHING=_.T_OBSTRUCTS_PASSABILITY|_.T_OBSTRUCTS_VISION|_.T_OBSTRUCTS_ITEMS|_.T_OBSTRUCTS_GAS|_.T_OBSTRUCTS_SURFACE|_.T_OBSTRUCTS_LIQUID|_.T_OBSTRUCTS_DIAGONAL_MOVEMENT]="T_OBSTRUCTS_EVERYTHING",_[_.T_HARMFUL_TERRAIN=_.T_CAUSES_POISON|_.T_IS_FIRE|_.T_CAUSES_DAMAGE|_.T_CAUSES_PARALYSIS|_.T_CAUSES_CONFUSION|_.T_CAUSES_EXPLOSIVE_DAMAGE]="T_HARMFUL_TERRAIN",_[_.T_RESPIRATION_IMMUNITIES=_.T_CAUSES_DAMAGE|_.T_CAUSES_CONFUSION|_.T_CAUSES_PARALYSIS|_.T_CAUSES_NAUSEA]="T_RESPIRATION_IMMUNITIES",_[_.T_IS_LIQUID=_.T_LAVA|_.T_AUTO_DESCENT|_.T_DEEP_WATER]="T_IS_LIQUID",_[_.T_STAIR_BLOCKERS=_.T_OBSTRUCTS_ITEMS|_.T_OBSTRUCTS_SURFACE|_.T_OBSTRUCTS_GAS|_.T_OBSTRUCTS_LIQUID|_.T_OBSTRUCTS_TILE_EFFECTS]="T_STAIR_BLOCKERS"}(I||(I={})),function(_){_[_.TM_IS_SECRET=S(0)]="TM_IS_SECRET",_[_.TM_PROMOTES_WITH_KEY=S(1)]="TM_PROMOTES_WITH_KEY",_[_.TM_PROMOTES_WITHOUT_KEY=S(2)]="TM_PROMOTES_WITHOUT_KEY",_[_.TM_PROMOTES_ON_STEP=S(3)]="TM_PROMOTES_ON_STEP",_[_.TM_PROMOTES_ON_ITEM_REMOVE=S(4)]="TM_PROMOTES_ON_ITEM_REMOVE",_[_.TM_PROMOTES_ON_PLAYER_ENTRY=S(5)]="TM_PROMOTES_ON_PLAYER_ENTRY",_[_.TM_PROMOTES_ON_SACRIFICE_ENTRY=S(6)]="TM_PROMOTES_ON_SACRIFICE_ENTRY",_[_.TM_PROMOTES_ON_ELECTRICITY=S(7)]="TM_PROMOTES_ON_ELECTRICITY",_[_.TM_ALLOWS_SUBMERGING=S(8)]="TM_ALLOWS_SUBMERGING",_[_.TM_IS_WIRED=S(9)]="TM_IS_WIRED",_[_.TM_IS_CIRCUIT_BREAKER=S(10)]="TM_IS_CIRCUIT_BREAKER",_[_.TM_EXTINGUISHES_FIRE=S(14)]="TM_EXTINGUISHES_FIRE",_[_.TM_VANISHES_UPON_PROMOTION=S(15)]="TM_VANISHES_UPON_PROMOTION",_[_.TM_REFLECTS_BOLTS=S(16)]="TM_REFLECTS_BOLTS",_[_.TM_STAND_IN_TILE=S(17)]="TM_STAND_IN_TILE",_[_.TM_LIST_IN_SIDEBAR=S(18)]="TM_LIST_IN_SIDEBAR",_[_.TM_VISUALLY_DISTINCT=S(19)]="TM_VISUALLY_DISTINCT",_[_.TM_BRIGHT_MEMORY=S(20)]="TM_BRIGHT_MEMORY",_[_.TM_EXPLOSIVE_PROMOTE=S(21)]="TM_EXPLOSIVE_PROMOTE",_[_.TM_CONNECTS_LEVEL=S(22)]="TM_CONNECTS_LEVEL",_[_.TM_INTERRUPT_EXPLORATION_WHEN_SEEN=S(23)]="TM_INTERRUPT_EXPLORATION_WHEN_SEEN",_[_.TM_INVERT_WHEN_HIGHLIGHTED=S(24)]="TM_INVERT_WHEN_HIGHLIGHTED",_[_.TM_SWAP_ENCHANTS_ACTIVATION=S(25)]="TM_SWAP_ENCHANTS_ACTIVATION",_[_.TM_PROMOTES=_.TM_PROMOTES_WITH_KEY|_.TM_PROMOTES_WITHOUT_KEY|_.TM_PROMOTES_ON_STEP|_.TM_PROMOTES_ON_ITEM_REMOVE|_.TM_PROMOTES_ON_SACRIFICE_ENTRY|_.TM_PROMOTES_ON_ELECTRICITY|_.TM_PROMOTES_ON_PLAYER_ENTRY]="TM_PROMOTES"}(R||(R={})),function(_){_[_.REVEALED=S(0)]="REVEALED",_[_.VISIBLE=S(1)]="VISIBLE",_[_.WAS_VISIBLE=S(2)]="WAS_VISIBLE",_[_.IN_FOV=S(3)]="IN_FOV",_[_.HAS_PLAYER=S(4)]="HAS_PLAYER",_[_.HAS_MONSTER=S(5)]="HAS_MONSTER",_[_.HAS_DORMANT_MONSTER=S(6)]="HAS_DORMANT_MONSTER",_[_.HAS_ITEM=S(7)]="HAS_ITEM",_[_.HAS_STAIRS=S(8)]="HAS_STAIRS",_[_.NEEDS_REDRAW=S(9)]="NEEDS_REDRAW",_[_.CELL_CHANGED=S(10)]="CELL_CHANGED",_[_.IS_IN_PATH=S(12)]="IS_IN_PATH",_[_.IS_CURSOR=S(13)]="IS_CURSOR",_[_.MAGIC_MAPPED=S(14)]="MAGIC_MAPPED",_[_.ITEM_DETECTED=S(15)]="ITEM_DETECTED",_[_.STABLE_MEMORY=S(16)]="STABLE_MEMORY",_[_.CLAIRVOYANT_VISIBLE=S(17)]="CLAIRVOYANT_VISIBLE",_[_.WAS_CLAIRVOYANT_VISIBLE=S(18)]="WAS_CLAIRVOYANT_VISIBLE",_[_.CLAIRVOYANT_DARKENED=S(19)]="CLAIRVOYANT_DARKENED",_[_.IMPREGNABLE=S(20)]="IMPREGNABLE",_[_.TELEPATHIC_VISIBLE=S(22)]="TELEPATHIC_VISIBLE",_[_.WAS_TELEPATHIC_VISIBLE=S(23)]="WAS_TELEPATHIC_VISIBLE",_[_.MONSTER_DETECTED=S(24)]="MONSTER_DETECTED",_[_.WAS_MONSTER_DETECTED=S(25)]="WAS_MONSTER_DETECTED",_[_.LIGHT_CHANGED=S(27)]="LIGHT_CHANGED",_[_.CELL_LIT=S(28)]="CELL_LIT",_[_.IS_IN_SHADOW=S(29)]="IS_IN_SHADOW",_[_.CELL_DARK=S(30)]="CELL_DARK",_[_.PERMANENT_CELL_FLAGS=_.REVEALED|_.MAGIC_MAPPED|_.ITEM_DETECTED|_.HAS_ITEM|_.HAS_DORMANT_MONSTER|_.HAS_STAIRS|_.STABLE_MEMORY|_.IMPREGNABLE]="PERMANENT_CELL_FLAGS",_[_.ANY_KIND_OF_VISIBLE=_.VISIBLE|_.CLAIRVOYANT_VISIBLE|_.TELEPATHIC_VISIBLE]="ANY_KIND_OF_VISIBLE",_[_.HAS_ACTOR=_.HAS_PLAYER|_.HAS_MONSTER]="HAS_ACTOR",_[_.IS_WAS_ANY_KIND_OF_VISIBLE=_.VISIBLE|_.WAS_VISIBLE|_.CLAIRVOYANT_VISIBLE|_.WAS_CLAIRVOYANT_VISIBLE|_.TELEPATHIC_VISIBLE|_.WAS_TELEPATHIC_VISIBLE]="IS_WAS_ANY_KIND_OF_VISIBLE",_[_.CELL_DEFAULT=_.VISIBLE|_.IN_FOV|_.NEEDS_REDRAW|_.CELL_CHANGED|_.IS_IN_SHADOW]="CELL_DEFAULT"}(O||(O={})),function(_){_[_.SEARCHED_FROM_HERE=S(0)]="SEARCHED_FROM_HERE",_[_.PRESSURE_PLATE_DEPRESSED=S(1)]="PRESSURE_PLATE_DEPRESSED",_[_.KNOWN_TO_BE_TRAP_FREE=S(2)]="KNOWN_TO_BE_TRAP_FREE",_[_.CAUGHT_FIRE_THIS_TURN=S(4)]="CAUGHT_FIRE_THIS_TURN",_[_.EVENT_FIRED_THIS_TURN=S(5)]="EVENT_FIRED_THIS_TURN",_[_.EVENT_PROTECTED=S(6)]="EVENT_PROTECTED",_[_.IS_IN_LOOP=S(10)]="IS_IN_LOOP",_[_.IS_CHOKEPOINT=S(11)]="IS_CHOKEPOINT",_[_.IS_GATE_SITE=S(12)]="IS_GATE_SITE",_[_.IS_IN_ROOM_MACHINE=S(13)]="IS_IN_ROOM_MACHINE",_[_.IS_IN_AREA_MACHINE=S(14)]="IS_IN_AREA_MACHINE",_[_.IS_POWERED=S(15)]="IS_POWERED",_[_.IS_IN_MACHINE=_.IS_IN_ROOM_MACHINE|_.IS_IN_AREA_MACHINE]="IS_IN_MACHINE",_[_.PERMANENT_MECH_FLAGS=_.SEARCHED_FROM_HERE|_.PRESSURE_PLATE_DEPRESSED|_.KNOWN_TO_BE_TRAP_FREE|_.IS_IN_LOOP|_.IS_CHOKEPOINT|_.IS_GATE_SITE|_.IS_IN_MACHINE]="PERMANENT_MECH_FLAGS"}(L||(L={})),function(_){_[_.MAP_CHANGED=S(0)]="MAP_CHANGED",_[_.MAP_STABLE_GLOW_LIGHTS=S(1)]="MAP_STABLE_GLOW_LIGHTS",_[_.MAP_STABLE_LIGHTS=S(2)]="MAP_STABLE_LIGHTS",_[_.MAP_ALWAYS_LIT=S(3)]="MAP_ALWAYS_LIT",_[_.MAP_SAW_WELCOME=S(4)]="MAP_SAW_WELCOME",_[_.MAP_NO_LIQUID=S(5)]="MAP_NO_LIQUID",_[_.MAP_NO_GAS=S(6)]="MAP_NO_GAS",_[_.MAP_FOV_CHANGED=S(7)]="MAP_FOV_CHANGED",_[_.MAP_DEFAULT=_.MAP_STABLE_LIGHTS|_.MAP_STABLE_GLOW_LIGHTS|_.MAP_FOV_CHANGED]="MAP_DEFAULT"}(N||(N={}));T.config.light={INTENSITY_DARK:20},T.color.make();const C={};class M{constructor(_,S){this.flags=0,this.mechFlags=0,this.layer=E.GROUND,this.priority=-1,this.sprite={},this.activates={},this.light=null,this.flavor=null,this.desc=null,this.article=null,this.dissipate=2e3,void 0!==S&&T.utils.assignOmitting(["activates"],this,S),T.utils.assignOmitting(["Extends","extends","flags","mechFlags","sprite","activates","ch","fg","bg","light"],this,_),this.name=_.name||(S?S.name:"tile"),this.id=_.id,this.priority<0&&(this.priority=50),void 0!==this.layer&&"string"==typeof this.layer&&(this.layer=E[this.layer]),this.flags=T.flag.from(I,this.flags,_.flags),this.mechFlags=T.flag.from(R,this.mechFlags,_.mechFlags||_.flags),_.light&&("string"==typeof _.light?this.light=C[_.light]||null:this.light=_.light),_.sprite?this.sprite=T.canvas.makeSprite(_.sprite):(_.ch||_.fg||_.bg)&&(this.sprite=T.canvas.makeSprite(_.ch||null,_.fg||null,_.bg||null,_.opacity)),S&&S.activates&&Object.assign(this.activates,S.activates),_.activates&&Object.entries(_.activates).forEach((([_,T])=>{T?this.activates[_]=T:delete this.activates[_]}))}successorFlags(_){const T=this.activates[_];if(!T)return 0;const E=T.tile;if(!E)return 0;const S=D[E];return S?S.flags:0}hasFlag(_){return(this.flags&_)>0}hasFlags(_,T){return(!_||this.flags&_)&&(!T||this.mechFlags&T)}hasMechFlag(_){return(this.mechFlags&_)>0}hasEvent(_){return!!this.activates[_]}getName(_={}){if(!0===_&&(_={article:!0}),!1===_&&(_={}),"string"==typeof _&&(_={article:_}),!_.article&&!_.color)return this.name;let E=this.name;if(_.color){let _=this.sprite.fg;"string"!=typeof _&&(_=T.color.from(_).toString()),E=`Ω${_}Ω${this.name}∆`}if(_.article&&this.article){E=(!0===_.article?this.article:_.article)+" "+E}return E}}const D={};function F(..._){let E=_[0],S=_[1],A=_[2];1==arguments.length?(A=_[0],S=A.Extends||A.extends||{},E=A.id||A.name):2==arguments.length&&(A=S,S=A.Extends||A.extends||{}),"string"==typeof S&&(S=D[S]||T.utils.ERROR("Unknown base tile: "+S)),A.name=A.name||E.toLowerCase(),A.id=E;const I=new M(A,S);return D[E]=I,I}var t={__proto__:null,get Flags(){return I},get MechFlags(){return R},get Layer(){return E},Tile:M,tiles:D,install:F,installAll:function(_){Object.entries(_).forEach((([_,T])=>{F(_,T)}))}};_.tile=t,Object.defineProperty(_,"__esModule",{value:!0})}));
//# sourceMappingURL=gw-map.min.js.map
