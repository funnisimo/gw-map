!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("gw-utils")):"function"==typeof define&&define.amd?define(["exports","gw-utils"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).GW=t.GW||{},t.GW)}(this,(function(t,i){"use strict";var e;!function(t){t[t.GROUND=0]="GROUND",t[t.LIQUID=1]="LIQUID",t[t.SURFACE=2]="SURFACE",t[t.GAS=3]="GAS",t[t.ITEM=4]="ITEM",t[t.ACTOR=5]="ACTOR",t[t.PLAYER=6]="PLAYER",t[t.FX=7]="FX",t[t.UI=8]="UI"}(e||(e={}));const s=i.flag.fl;var l,r,_,a,T,h;!function(t){t[t.DFF_SUBSEQ_ALWAYS=s(0)]="DFF_SUBSEQ_ALWAYS",t[t.DFF_SUBSEQ_EVERYWHERE=s(1)]="DFF_SUBSEQ_EVERYWHERE",t[t.DFF_TREAT_AS_BLOCKING=s(2)]="DFF_TREAT_AS_BLOCKING",t[t.DFF_PERMIT_BLOCKING=s(3)]="DFF_PERMIT_BLOCKING",t[t.DFF_ACTIVATE_DORMANT_MONSTER=s(4)]="DFF_ACTIVATE_DORMANT_MONSTER",t[t.DFF_BLOCKED_BY_OTHER_LAYERS=s(6)]="DFF_BLOCKED_BY_OTHER_LAYERS",t[t.DFF_SUPERPRIORITY=s(7)]="DFF_SUPERPRIORITY",t[t.DFF_AGGRAVATES_MONSTERS=s(8)]="DFF_AGGRAVATES_MONSTERS",t[t.DFF_RESURRECT_ALLY=s(9)]="DFF_RESURRECT_ALLY",t[t.DFF_EMIT_EVENT=s(10)]="DFF_EMIT_EVENT",t[t.DFF_NO_REDRAW_CELL=s(11)]="DFF_NO_REDRAW_CELL",t[t.DFF_ABORT_IF_BLOCKS_MAP=s(12)]="DFF_ABORT_IF_BLOCKS_MAP",t[t.DFF_BLOCKED_BY_ITEMS=s(13)]="DFF_BLOCKED_BY_ITEMS",t[t.DFF_BLOCKED_BY_ACTORS=s(14)]="DFF_BLOCKED_BY_ACTORS",t[t.DFF_ALWAYS_FIRE=s(15)]="DFF_ALWAYS_FIRE",t[t.DFF_NO_MARK_FIRED=s(16)]="DFF_NO_MARK_FIRED",t[t.DFF_PROTECTED=s(19)]="DFF_PROTECTED",t[t.DFF_SPREAD_CIRCLE=s(20)]="DFF_SPREAD_CIRCLE",t[t.DFF_SPREAD_LINE=s(21)]="DFF_SPREAD_LINE",t[t.DFF_NULL_SURFACE=s(22)]="DFF_NULL_SURFACE",t[t.DFF_NULL_LIQUID=s(23)]="DFF_NULL_LIQUID",t[t.DFF_NULL_GAS=s(24)]="DFF_NULL_GAS",t[t.DFF_EVACUATE_CREATURES=s(25)]="DFF_EVACUATE_CREATURES",t[t.DFF_EVACUATE_ITEMS=s(26)]="DFF_EVACUATE_ITEMS",t[t.DFF_BUILD_IN_WALLS=s(27)]="DFF_BUILD_IN_WALLS",t[t.DFF_MUST_TOUCH_WALLS=s(28)]="DFF_MUST_TOUCH_WALLS",t[t.DFF_NO_TOUCH_WALLS=s(29)]="DFF_NO_TOUCH_WALLS",t[t.DFF_ONLY_IF_EMPTY=t.DFF_BLOCKED_BY_ITEMS|t.DFF_BLOCKED_BY_ACTORS]="DFF_ONLY_IF_EMPTY",t[t.DFF_NULLIFY_CELL=t.DFF_NULL_SURFACE|t.DFF_NULL_LIQUID|t.DFF_NULL_GAS]="DFF_NULLIFY_CELL"}(l||(l={})),function(t){t[t.T_OBSTRUCTS_PASSABILITY=s(0)]="T_OBSTRUCTS_PASSABILITY",t[t.T_OBSTRUCTS_VISION=s(1)]="T_OBSTRUCTS_VISION",t[t.T_OBSTRUCTS_ITEMS=s(2)]="T_OBSTRUCTS_ITEMS",t[t.T_OBSTRUCTS_SURFACE=s(3)]="T_OBSTRUCTS_SURFACE",t[t.T_OBSTRUCTS_GAS=s(4)]="T_OBSTRUCTS_GAS",t[t.T_OBSTRUCTS_LIQUID=s(5)]="T_OBSTRUCTS_LIQUID",t[t.T_OBSTRUCTS_TILE_EFFECTS=s(6)]="T_OBSTRUCTS_TILE_EFFECTS",t[t.T_OBSTRUCTS_DIAGONAL_MOVEMENT=s(7)]="T_OBSTRUCTS_DIAGONAL_MOVEMENT",t[t.T_GAS=s(9)]="T_GAS",t[t.T_BRIDGE=s(10)]="T_BRIDGE",t[t.T_AUTO_DESCENT=s(11)]="T_AUTO_DESCENT",t[t.T_LAVA=s(12)]="T_LAVA",t[t.T_DEEP_WATER=s(13)]="T_DEEP_WATER",t[t.T_SPONTANEOUSLY_IGNITES=s(14)]="T_SPONTANEOUSLY_IGNITES",t[t.T_IS_FLAMMABLE=s(15)]="T_IS_FLAMMABLE",t[t.T_IS_FIRE=s(16)]="T_IS_FIRE",t[t.T_ENTANGLES=s(17)]="T_ENTANGLES",t[t.T_CAUSES_POISON=s(18)]="T_CAUSES_POISON",t[t.T_CAUSES_DAMAGE=s(19)]="T_CAUSES_DAMAGE",t[t.T_CAUSES_NAUSEA=s(20)]="T_CAUSES_NAUSEA",t[t.T_CAUSES_PARALYSIS=s(21)]="T_CAUSES_PARALYSIS",t[t.T_CAUSES_CONFUSION=s(22)]="T_CAUSES_CONFUSION",t[t.T_CAUSES_HEALING=s(23)]="T_CAUSES_HEALING",t[t.T_IS_TRAP=s(24)]="T_IS_TRAP",t[t.T_CAUSES_EXPLOSIVE_DAMAGE=s(25)]="T_CAUSES_EXPLOSIVE_DAMAGE",t[t.T_SACRED=s(26)]="T_SACRED",t[t.T_UP_STAIRS=s(27)]="T_UP_STAIRS",t[t.T_DOWN_STAIRS=s(28)]="T_DOWN_STAIRS",t[t.T_PORTAL=s(29)]="T_PORTAL",t[t.T_IS_DOOR=s(30)]="T_IS_DOOR",t[t.T_HAS_STAIRS=t.T_UP_STAIRS|t.T_DOWN_STAIRS|t.T_PORTAL]="T_HAS_STAIRS",t[t.T_OBSTRUCTS_SCENT=t.T_OBSTRUCTS_PASSABILITY|t.T_OBSTRUCTS_VISION|t.T_AUTO_DESCENT|t.T_LAVA|t.T_DEEP_WATER|t.T_SPONTANEOUSLY_IGNITES|t.T_HAS_STAIRS]="T_OBSTRUCTS_SCENT",t[t.T_PATHING_BLOCKER=t.T_OBSTRUCTS_PASSABILITY|t.T_AUTO_DESCENT|t.T_IS_TRAP|t.T_LAVA|t.T_DEEP_WATER|t.T_IS_FIRE|t.T_SPONTANEOUSLY_IGNITES|t.T_ENTANGLES]="T_PATHING_BLOCKER",t[t.T_DIVIDES_LEVEL=t.T_OBSTRUCTS_PASSABILITY|t.T_AUTO_DESCENT|t.T_IS_TRAP|t.T_LAVA|t.T_DEEP_WATER]="T_DIVIDES_LEVEL",t[t.T_LAKE_PATHING_BLOCKER=t.T_AUTO_DESCENT|t.T_LAVA|t.T_DEEP_WATER|t.T_SPONTANEOUSLY_IGNITES]="T_LAKE_PATHING_BLOCKER",t[t.T_WAYPOINT_BLOCKER=t.T_OBSTRUCTS_PASSABILITY|t.T_AUTO_DESCENT|t.T_IS_TRAP|t.T_LAVA|t.T_DEEP_WATER|t.T_SPONTANEOUSLY_IGNITES]="T_WAYPOINT_BLOCKER",t[t.T_MOVES_ITEMS=t.T_DEEP_WATER|t.T_LAVA]="T_MOVES_ITEMS",t[t.T_CAN_BE_BRIDGED=t.T_AUTO_DESCENT|t.T_LAVA|t.T_DEEP_WATER]="T_CAN_BE_BRIDGED",t[t.T_OBSTRUCTS_EVERYTHING=t.T_OBSTRUCTS_PASSABILITY|t.T_OBSTRUCTS_VISION|t.T_OBSTRUCTS_ITEMS|t.T_OBSTRUCTS_GAS|t.T_OBSTRUCTS_SURFACE|t.T_OBSTRUCTS_LIQUID|t.T_OBSTRUCTS_DIAGONAL_MOVEMENT]="T_OBSTRUCTS_EVERYTHING",t[t.T_HARMFUL_TERRAIN=t.T_CAUSES_POISON|t.T_IS_FIRE|t.T_CAUSES_DAMAGE|t.T_CAUSES_PARALYSIS|t.T_CAUSES_CONFUSION|t.T_CAUSES_EXPLOSIVE_DAMAGE]="T_HARMFUL_TERRAIN",t[t.T_RESPIRATION_IMMUNITIES=t.T_CAUSES_DAMAGE|t.T_CAUSES_CONFUSION|t.T_CAUSES_PARALYSIS|t.T_CAUSES_NAUSEA]="T_RESPIRATION_IMMUNITIES",t[t.T_IS_LIQUID=t.T_LAVA|t.T_AUTO_DESCENT|t.T_DEEP_WATER]="T_IS_LIQUID",t[t.T_STAIR_BLOCKERS=t.T_OBSTRUCTS_ITEMS|t.T_OBSTRUCTS_SURFACE|t.T_OBSTRUCTS_GAS|t.T_OBSTRUCTS_LIQUID|t.T_OBSTRUCTS_TILE_EFFECTS]="T_STAIR_BLOCKERS"}(r||(r={})),function(t){t[t.TM_IS_SECRET=s(0)]="TM_IS_SECRET",t[t.TM_PROMOTES_WITH_KEY=s(1)]="TM_PROMOTES_WITH_KEY",t[t.TM_PROMOTES_WITHOUT_KEY=s(2)]="TM_PROMOTES_WITHOUT_KEY",t[t.TM_PROMOTES_ON_STEP=s(3)]="TM_PROMOTES_ON_STEP",t[t.TM_PROMOTES_ON_ITEM_REMOVE=s(4)]="TM_PROMOTES_ON_ITEM_REMOVE",t[t.TM_PROMOTES_ON_PLAYER_ENTRY=s(5)]="TM_PROMOTES_ON_PLAYER_ENTRY",t[t.TM_PROMOTES_ON_SACRIFICE_ENTRY=s(6)]="TM_PROMOTES_ON_SACRIFICE_ENTRY",t[t.TM_PROMOTES_ON_ELECTRICITY=s(7)]="TM_PROMOTES_ON_ELECTRICITY",t[t.TM_ALLOWS_SUBMERGING=s(8)]="TM_ALLOWS_SUBMERGING",t[t.TM_IS_WIRED=s(9)]="TM_IS_WIRED",t[t.TM_IS_CIRCUIT_BREAKER=s(10)]="TM_IS_CIRCUIT_BREAKER",t[t.TM_EXTINGUISHES_FIRE=s(14)]="TM_EXTINGUISHES_FIRE",t[t.TM_VANISHES_UPON_PROMOTION=s(15)]="TM_VANISHES_UPON_PROMOTION",t[t.TM_REFLECTS_BOLTS=s(16)]="TM_REFLECTS_BOLTS",t[t.TM_STAND_IN_TILE=s(17)]="TM_STAND_IN_TILE",t[t.TM_LIST_IN_SIDEBAR=s(18)]="TM_LIST_IN_SIDEBAR",t[t.TM_VISUALLY_DISTINCT=s(19)]="TM_VISUALLY_DISTINCT",t[t.TM_BRIGHT_MEMORY=s(20)]="TM_BRIGHT_MEMORY",t[t.TM_EXPLOSIVE_PROMOTE=s(21)]="TM_EXPLOSIVE_PROMOTE",t[t.TM_CONNECTS_LEVEL=s(22)]="TM_CONNECTS_LEVEL",t[t.TM_INTERRUPT_EXPLORATION_WHEN_SEEN=s(23)]="TM_INTERRUPT_EXPLORATION_WHEN_SEEN",t[t.TM_INVERT_WHEN_HIGHLIGHTED=s(24)]="TM_INVERT_WHEN_HIGHLIGHTED",t[t.TM_SWAP_ENCHANTS_ACTIVATION=s(25)]="TM_SWAP_ENCHANTS_ACTIVATION",t[t.TM_PROMOTES=t.TM_PROMOTES_WITH_KEY|t.TM_PROMOTES_WITHOUT_KEY|t.TM_PROMOTES_ON_STEP|t.TM_PROMOTES_ON_ITEM_REMOVE|t.TM_PROMOTES_ON_SACRIFICE_ENTRY|t.TM_PROMOTES_ON_ELECTRICITY|t.TM_PROMOTES_ON_PLAYER_ENTRY]="TM_PROMOTES"}(_||(_={})),function(t){t[t.REVEALED=s(0)]="REVEALED",t[t.VISIBLE=s(1)]="VISIBLE",t[t.WAS_VISIBLE=s(2)]="WAS_VISIBLE",t[t.IN_FOV=s(3)]="IN_FOV",t[t.HAS_PLAYER=s(4)]="HAS_PLAYER",t[t.HAS_MONSTER=s(5)]="HAS_MONSTER",t[t.HAS_DORMANT_MONSTER=s(6)]="HAS_DORMANT_MONSTER",t[t.HAS_ITEM=s(7)]="HAS_ITEM",t[t.HAS_STAIRS=s(8)]="HAS_STAIRS",t[t.NEEDS_REDRAW=s(9)]="NEEDS_REDRAW",t[t.CELL_CHANGED=s(10)]="CELL_CHANGED",t[t.IS_IN_PATH=s(12)]="IS_IN_PATH",t[t.IS_CURSOR=s(13)]="IS_CURSOR",t[t.MAGIC_MAPPED=s(14)]="MAGIC_MAPPED",t[t.ITEM_DETECTED=s(15)]="ITEM_DETECTED",t[t.STABLE_MEMORY=s(16)]="STABLE_MEMORY",t[t.CLAIRVOYANT_VISIBLE=s(17)]="CLAIRVOYANT_VISIBLE",t[t.WAS_CLAIRVOYANT_VISIBLE=s(18)]="WAS_CLAIRVOYANT_VISIBLE",t[t.CLAIRVOYANT_DARKENED=s(19)]="CLAIRVOYANT_DARKENED",t[t.IMPREGNABLE=s(20)]="IMPREGNABLE",t[t.TELEPATHIC_VISIBLE=s(22)]="TELEPATHIC_VISIBLE",t[t.WAS_TELEPATHIC_VISIBLE=s(23)]="WAS_TELEPATHIC_VISIBLE",t[t.MONSTER_DETECTED=s(24)]="MONSTER_DETECTED",t[t.WAS_MONSTER_DETECTED=s(25)]="WAS_MONSTER_DETECTED",t[t.LIGHT_CHANGED=s(27)]="LIGHT_CHANGED",t[t.CELL_LIT=s(28)]="CELL_LIT",t[t.IS_IN_SHADOW=s(29)]="IS_IN_SHADOW",t[t.CELL_DARK=s(30)]="CELL_DARK",t[t.PERMANENT_CELL_FLAGS=t.REVEALED|t.MAGIC_MAPPED|t.ITEM_DETECTED|t.HAS_ITEM|t.HAS_DORMANT_MONSTER|t.HAS_STAIRS|t.STABLE_MEMORY|t.IMPREGNABLE]="PERMANENT_CELL_FLAGS",t[t.ANY_KIND_OF_VISIBLE=t.VISIBLE|t.CLAIRVOYANT_VISIBLE|t.TELEPATHIC_VISIBLE]="ANY_KIND_OF_VISIBLE",t[t.HAS_ACTOR=t.HAS_PLAYER|t.HAS_MONSTER]="HAS_ACTOR",t[t.IS_WAS_ANY_KIND_OF_VISIBLE=t.VISIBLE|t.WAS_VISIBLE|t.CLAIRVOYANT_VISIBLE|t.WAS_CLAIRVOYANT_VISIBLE|t.TELEPATHIC_VISIBLE|t.WAS_TELEPATHIC_VISIBLE]="IS_WAS_ANY_KIND_OF_VISIBLE",t[t.CELL_DEFAULT=t.VISIBLE|t.IN_FOV|t.NEEDS_REDRAW|t.CELL_CHANGED]="CELL_DEFAULT"}(a||(a={})),function(t){t[t.SEARCHED_FROM_HERE=s(0)]="SEARCHED_FROM_HERE",t[t.PRESSURE_PLATE_DEPRESSED=s(1)]="PRESSURE_PLATE_DEPRESSED",t[t.KNOWN_TO_BE_TRAP_FREE=s(2)]="KNOWN_TO_BE_TRAP_FREE",t[t.CAUGHT_FIRE_THIS_TURN=s(4)]="CAUGHT_FIRE_THIS_TURN",t[t.EVENT_FIRED_THIS_TURN=s(5)]="EVENT_FIRED_THIS_TURN",t[t.EVENT_PROTECTED=s(6)]="EVENT_PROTECTED",t[t.IS_IN_LOOP=s(10)]="IS_IN_LOOP",t[t.IS_CHOKEPOINT=s(11)]="IS_CHOKEPOINT",t[t.IS_GATE_SITE=s(12)]="IS_GATE_SITE",t[t.IS_IN_ROOM_MACHINE=s(13)]="IS_IN_ROOM_MACHINE",t[t.IS_IN_AREA_MACHINE=s(14)]="IS_IN_AREA_MACHINE",t[t.IS_POWERED=s(15)]="IS_POWERED",t[t.IS_IN_MACHINE=t.IS_IN_ROOM_MACHINE|t.IS_IN_AREA_MACHINE]="IS_IN_MACHINE",t[t.PERMANENT_MECH_FLAGS=t.SEARCHED_FROM_HERE|t.PRESSURE_PLATE_DEPRESSED|t.KNOWN_TO_BE_TRAP_FREE|t.IS_IN_LOOP|t.IS_CHOKEPOINT|t.IS_GATE_SITE|t.IS_IN_MACHINE]="PERMANENT_MECH_FLAGS"}(T||(T={})),function(t){t[t.MAP_CHANGED=s(0)]="MAP_CHANGED",t[t.MAP_STABLE_GLOW_LIGHTS=s(1)]="MAP_STABLE_GLOW_LIGHTS",t[t.MAP_STABLE_LIGHTS=s(2)]="MAP_STABLE_LIGHTS",t[t.MAP_ALWAYS_LIT=s(3)]="MAP_ALWAYS_LIT",t[t.MAP_SAW_WELCOME=s(4)]="MAP_SAW_WELCOME",t[t.MAP_NO_LIQUID=s(5)]="MAP_NO_LIQUID",t[t.MAP_NO_GAS=s(6)]="MAP_NO_GAS",t[t.MAP_FOV_CHANGED=s(7)]="MAP_FOV_CHANGED",t[t.MAP_DEFAULT=t.MAP_STABLE_LIGHTS|t.MAP_STABLE_GLOW_LIGHTS|t.MAP_FOV_CHANGED]="MAP_DEFAULT"}(h||(h={}));class n{constructor(t={}){"function"==typeof t&&(t={fn:t}),this.tile=t.tile||null,this.fn=t.fn||null,this.item=t.item||null,this.chance=t.chance||0,this.volume=t.volume||0,this.spread=t.spread||0,this.radius=t.radius||0,this.decrement=t.decrement||0,this.flags=i.flag.from(l,t.flags),this.matchTile=t.matchTile||t.needs||0,this.next=t.next||null,this.message=t.message||null,this.lightFlare=t.flare||null,this.flashColor=t.flash?i.color.from(t.flash):null,this.messageDisplayed=!1,this.emit=t.emit||null,this.id=t.id||null}}function E(t){if(!t)return null;"string"==typeof t&&(t={tile:t});return new n(t)}i.make.tileEvent=E;const o={DF_NONE:null};async function S(t,e={}){let s,_,a;if(!t)return!1;if(!e)return!1;if("string"==typeof t)a=o[t],a||i.utils.ERROR("Unknown tile Event: "+t);else{if("function"==typeof t)return t(e);a=t}const h=e.map,n=e.x,E=e.y;if(h&&void 0!==n&&void 0!==E||i.utils.ERROR("MAP, x, y are required in context."),e.safe&&h.hasCellMechFlag(n,E,T.EVENT_FIRED_THIS_TURN)&&!(a.flags&l.DFF_ALWAYS_FIRE))return!1;e.refreshCell=e.refreshCell||!(a.flags&l.DFF_NO_REDRAW_CELL);const c=e.abortIfBlocking=e.abortIfBlocking||a.flags&l.DFF_ABORT_IF_BLOCKS_MAP;a.message&&a.message.length&&!a.messageDisplayed&&h.isVisible(n,E)&&(a.messageDisplayed=!0,i.message.add(a.message));let L=null;a.tile&&(L=G[a.tile]||null,L||i.utils.ERROR("Unknown tile: "+a.tile));let R=null;a.item&&"item"in i.make&&(R=i.make.item(a.item),R||i.utils.ERROR("Unknown item: "+a.item));const O=e.blocking=!(!c||a.flags&l.DFF_PERMIT_BLOCKING||!(L&&L.flags&r.T_PATHING_BLOCKER||R&&R.blocksMove()||a.flags&l.DFF_TREAT_AS_BLOCKING)),F=i.grid.alloc(h.width,h.height);let N=!1;if(A(a,F,e),O&&h.gridDisruptsPassability(F,{bounds:e.bounds})||(a.flags&l.DFF_EVACUATE_CREATURES&&u(h,F)&&(N=!0),a.flags&l.DFF_EVACUATE_ITEMS&&f(h,F)&&(N=!0),a.flags&l.DFF_NULLIFY_CELL&&g(h,F,a.flags)&&(N=!0),(L||R||a.fn)&&await I(a,F,e,L,R)&&(N=!0)),R&&R.delete(),N&&a.flags&l.DFF_PROTECTED&&F.forEach(((t,i,e)=>{if(!t)return;h.cell(i,e).mechFlags|=T.EVENT_PROTECTED})),N)for(let t=0;t<F.width;++t)for(let e=0;e<F.height;++e){if(!F[t][e]||i.data.gameHasEnded)continue;const s=h.cell(t,e);if(s.actor||s.item)for(let l of s.tiles())if(await l.applyInstantEffects(h,t,e,s),i.data.gameHasEnded)return!0}if(a.emit&&(await i.events.emit(a.emit,e),N=!0),i.data.gameHasEnded)return i.grid.free(F),N;if(a.next&&(N||a.flags&l.DFF_SUBSEQ_ALWAYS))if(a.flags&l.DFF_SUBSEQ_EVERYWHERE){for(s=0;s<h.width;s++)for(_=0;_<h.height;_++)F[s][_]&&(e.x=s,e.y=_,await S(a.next,e));e.x=n,e.y=E}else await S(a.next,e);return N&&L&&L.flags&(r.T_DEEP_WATER|r.T_LAVA|r.T_AUTO_DESCENT)&&(i.data.updateMapToShoreThisTurn=!1),N&&(F.forEach(((t,i,e)=>{t&&h.redrawXY(i,e)})),h.changed(!0),a.flags&l.DFF_NO_MARK_FIRED||F.forEach(((t,i,e)=>{t&&h.setCellFlags(i,e,0,T.EVENT_FIRED_THIS_TURN)}))),i.grid.free(F),N}function c(t,i,e,s={}){const _=s.map;if(!_.hasXY(i,e))return!1;const a=_.cell(i,e);if(t.flags&l.DFF_BUILD_IN_WALLS){if(!a.isWall())return!1}else if(t.flags&l.DFF_MUST_TOUCH_WALLS){let t=!1;if(_.eachNeighbor(i,e,(i=>{i.isWall()&&(t=!0)})),!t)return!1}else if(t.flags&l.DFF_NO_TOUCH_WALLS){let t=!0;if(_.eachNeighbor(i,e,(i=>{i.isWall()&&(t=!1)})),!t)return!1}return!(s.bounds&&!s.bounds.containsXY(i,e))&&(!(t.matchTile&&!a.hasTile(t.matchTile))&&!(a.hasTileFlag(r.T_OBSTRUCTS_TILE_EFFECTS)&&!t.matchTile&&(s.x!=i||s.y!=e)))}function A(t,e,s={}){let r,_,a,T,h,n,E;const o=s.map,S=s.x,A=s.y;s.bounds;let I=t.spread||0,g=t.decrement||0;if(t.matchTile&&"string"==typeof t.matchTile){const e=t.matchTile,s=G[e];s||i.utils.ERROR("Failed to find match tile with name:"+e),t.matchTile=s.id}e[S][A]=T=1;let u=t.radius||0;if(t.flags&l.DFF_SPREAD_CIRCLE){for(u=0,I=I||100,I>=100&&(g=g||100);i.random.chance(I);)I-=g,++u;I=100,g=0}if(u)I=I||100,e.updateCircle(S,A,u,((e,l,r)=>{if(!c(t,l,r,s))return 0;const _=Math.floor(i.utils.distanceBetween(S,A,l,r)),a=I-_*g;return i.random.chance(a)?1:0})),e[S][A]=1;else if(I)if(E=!0,I>=100&&(g=g||100),t.flags&l.DFF_SPREAD_LINE){h=S,n=A;const l=i.utils.DIRS[i.random.number(4)];for(;E;)E=!1,h+=l[0],n+=l[1],e.hasXY(h,n)&&!e[h][n]&&c(t,h,n,s)&&i.random.chance(I)&&(e[h][n]=1,E=!0,I-=g)}else for(g<=0&&(g=I);E&&I>0;){for(E=!1,T++,r=0;r<o.width;r++)for(_=0;_<o.height;_++)if(e[r][_]==T-1)for(a=0;a<4;a++)h=r+i.utils.DIRS[a][0],n=_+i.utils.DIRS[a][1],e.hasXY(h,n)&&!e[h][n]&&c(t,h,n,s)&&i.random.chance(I)&&(e[h][n]=T,E=!0);I-=g}c(t,S,A,s)||(e[S][A]=0)}async function I(t,i,s,_,a){let h,n,E;E=!1;const o=t.flags&l.DFF_BLOCKED_BY_OTHER_LAYERS,S=t.flags&l.DFF_SUPERPRIORITY,c=(s.refreshCell,s.map),A=s.volume||t.volume||0;for(h=0;h<i.width;h++)for(n=0;n<i.height;n++){if(!i[h][n])continue;i[h][n]=0;const I=c.cell(h,n);if(!(I.mechFlags&T.EVENT_PROTECTED)){if(_&&(I.layers[_.layer]===_.id?_.layer==e.GAS?(i[h][n]=1,I.gasVolume+=A):_.layer==e.LIQUID&&(i[h][n]=1,I.liquidVolume+=A):!(S||I.tile(_.layer).priority<_.priority)||I.obstructsLayer(_.layer)||I.item&&t.flags&l.DFF_BLOCKED_BY_ITEMS||I.actor&&t.flags&l.DFF_BLOCKED_BY_ACTORS||o&&!(I.highestPriorityTile().priority<_.priority)||(i[h][n]=1,c.setTile(h,n,_,A),E=!0)),a&&(S||!I.item)&&!I.hasTileFlag(r.T_OBSTRUCTS_ITEMS)){i[h][n]=1,I.item&&c.removeItem(I.item);const t=a.clone();c.addItem(h,n,t),E=!0}t.fn&&(s.spawnMap=i,await t.fn(h,n,s)&&(i[h][n]=1,E=!0))}}return E&&c.changed(!0),E}function g(t,i,e){let s=!1;const r=e&l.DFF_NULL_SURFACE,_=e&l.DFF_NULL_LIQUID,a=e&l.DFF_NULL_GAS;return i.forEach(((i,e,l)=>{i&&(t.nullifyCellLayers(e,l,!!_,!!r,!!a),s=!0)})),s}function u(t,i){let e,s,l=!1;for(e=0;e<t.width;e++)for(s=0;s<t.height;s++){if(!i[e][s])continue;const r=t.cell(e,s);if(!r.actor)continue;const _=r.actor,a=t.matchingLocNear(e,s,(t=>!_.forbidsCell(t)),{hallways:!0,blockingMap:i});a&&a[0]>=0&&a[1]>=0&&(t.moveActor(a[0],a[1],_),l=!0)}return l}function f(t,i){let e=!1;return i.forEach(((s,l,r)=>{if(!s)return;const _=t.cell(l,r);if(!_.item)return;const a=_.item,T=t.matchingLocNear(l,r,(t=>!a.forbidsCell(t)),{hallways:!0,blockingMap:i});T&&T[0]>=0&&T[1]>=0&&(t.removeItem(a),t.addItem(T[0],T[1],a),e=!0)})),e}var L={__proto__:null,get Flags(){return l},TileEvent:n,make:E,activations:o,install:function(t,i){return i instanceof n||(i=E(i)),o[t]=i,i&&(i.id=t),i},resetAllMessages:function(){Object.values(o).forEach((t=>{t instanceof n&&(t.messageDisplayed=!1)}))},spawn:S,computeSpawnMap:A,spawnTiles:I,nullifyCells:g,evacuateCreatures:u,evacuateItems:f};const R=i.config.light={INTENSITY_DARK:20},O=i.color.make();class F{constructor(t,e,s,l=!1){this.fadeTo=0,this.passThroughActors=!1,this.id=null,this.color=i.color.from(t)||null,this.radius=i.range.make(e||1),this.fadeTo=s||0,this.passThroughActors=l}copy(t){this.color=t.color,this.radius.copy(t.radius),this.fadeTo=t.fadeTo,this.passThroughActors=t.passThroughActors}get intensity(){return N(this.color)}paint(t,e,s,l=!1,_=!1){if(!t)return;let T,h,n=this.radius.value(),E=Math.ceil(n);O.copy(this.color).bake();const o=!_&&!l&&N(O)>R.INTENSITY_DARK,S=this.fadeTo,c=i.grid.alloc(t.width,t.height,0);t.calcFov(c,e,s,E,this.passThroughActors?0:a.HAS_ACTOR,r.T_OBSTRUCTS_VISION);let A=!1;if(c.forCircle(e,s,E,((l,r,_)=>{if(!l)return;const E=t.cell(r,_);for(h=Math.floor(100-(100-S)*(i.utils.distanceBetween(e,s,r,_)/n)),T=0;T<3;T++)E.light[T]+=Math.floor(O[T]*h/100);o&&(E.flags&=~a.IS_IN_SHADOW),E.flags&(a.IN_FOV|a.ANY_KIND_OF_VISIBLE)&&(A=!0)})),o){t.cell(e,s).flags&=~a.IS_IN_SHADOW}return i.grid.free(c),A}}function N(t){return Math.max(t[0],t[1],t[2])}function C(...t){if(1==t.length){const e=t[0];if("string"==typeof e){const t=D[e];if(t)return t;const[s,l,r,_]=e.split(/[,|]/).map((t=>t.trim()));return new F(i.color.from(s),i.range.from(l||1),Number.parseInt(r||"0"),!!_&&"false"!==_)}if(Array.isArray(e)){const[t,i,s,l]=e;return new F(t,i,s,l)}if(e&&e.color)return new F(i.color.from(e.color),i.range.from(e.radius),Number.parseInt(e.fadeTo||"0"),e.pass);throw new Error("Unknown Light config - "+e)}{const[i,e,s,l]=t;return new F(i,e,s,l)}}i.make.light=C;const D={};function d(...t){1!=t.length&&i.utils.ERROR("Unknown Light config: "+JSON.stringify(t));const e=t[0];if("string"==typeof e){const t=D[e];if(t)return t}return C(e)}function M(t,...i){let e;return e=1==i.length?C(i[0]):C(i[0],i[1],i[2],i[3]),D[t]=e,e&&(e.id=t),e}function m(t){let i;t.eachCell((t=>{for(i=0;i<3;i++)t.oldLight[i]=t.light[i],t.flags&=~a.LIGHT_CHANGED}))}function P(t){let i;const e=t.ambientLight?t.ambientLight:[0,0,0];t.eachCell(((t,s,l)=>{for(i=0;i<3;i++)t.light[i]=e[i];t.flags|=a.IS_IN_SHADOW}))}function U(t){let i;t.eachCell((t=>{for(i=0;i<3;i++)t.glowLight[i]=t.light[i]}))}function y(t){let i;t.eachCell((t=>{for(i=0;i<3;i++)t.light[i]=t.glowLight[i]}))}var B={__proto__:null,config:R,Light:F,intensity:N,make:C,lights:D,from:d,install:M,installAll:function(t={}){Object.entries(t).forEach((([t,i])=>{M(t,i)}))},backUpLighting:function(t,i){let e;t.eachCell(((t,s,l)=>{for(e=0;e<3;e++)i[s][l][e]=t.light[e]}))},restoreLighting:function(t,i){let e;t.eachCell(((t,s,l)=>{for(e=0;e<3;e++)t.light[e]=i[s][l][e]}))},recordOldLights:m,zeroOutLights:P,recordGlowLights:U,restoreGlowLights:y,updateLighting:function(t){if(m(t),t.flags&h.MAP_STABLE_LIGHTS)return!1;P(t),t.flags&h.MAP_STABLE_GLOW_LIGHTS?y(t):(t.eachGlowLight(((i,e,s)=>{i&&i.paint(t,e,s)})),U(t),t.setFlag(h.MAP_STABLE_GLOW_LIGHTS)),t.eachDynamicLight(((i,e,s)=>{i.paint(t,e,s)})),function(t){t.eachCell(((t,i,e)=>{t.flags&=~(a.CELL_LIT|a.CELL_DARK),t.light.some(((i,e)=>i!==t.oldLight[e]))&&(t.flags|=a.LIGHT_CHANGED),t.isDark()?t.flags|=a.CELL_DARK:t.flags&a.IS_IN_SHADOW||(t.flags|=a.CELL_LIT)}))}(t);const e=i.data.player;if(e){const i=D.MINERS_LIGHT;i&&i.radius&&i.paint(t,e.x,e.y,!0,!0)}return t.setFlag(h.MAP_STABLE_LIGHTS),!0},playerInDarkness:function(t,i,e){const s=t.cell(i.x,i.y);return s.light[0]+10<e.r&&s.light[1]+10<e.g&&s.light[2]+10<e.b}};class p extends i.canvas.Sprite{constructor(t,s){super(i.utils.first(t.ch,null==s?void 0:s.ch,-1),i.utils.first(t.fg,null==s?void 0:s.fg,-1),i.utils.first(t.bg,null==s?void 0:s.bg,-1),i.utils.first(t.opacity,null==s?void 0:s.opacity,100)),this.flags=0,this.mechFlags=0,this.layer=e.GROUND,this.priority=-1,this.activates={},this.light=null,this.flavor=null,this.desc=null,this.article=null,this.dissipate=2e3,void 0!==s&&i.utils.assignOmitting(["activates","ch","fg","bg","opacity"],this,s),i.utils.assignOmitting(["Extends","extends","flags","mechFlags","sprite","activates","ch","fg","bg","opacity","light"],this,t),this.name=t.name||(s?s.name:t.id),this.id=t.id,this.layer=this.layer||e.GROUND,"string"==typeof this.layer&&(this.layer=e[this.layer]),this.priority<0&&(this.priority=50),this.flags=i.flag.from(r,this.flags,t.flags),this.mechFlags=i.flag.from(_,this.mechFlags,t.mechFlags||t.flags),t.light&&(this.light=d(t.light)),s&&s.activates&&Object.assign(this.activates,s.activates),t.activates&&Object.entries(t.activates).forEach((([t,i])=>{if(i){const e=E(i);this.activates[t]=e}else delete this.activates[t]}))}successorFlags(t){const i=this.activates[t];if(!i)return 0;const e=i.tile;if(!e)return 0;const s=G[e];return s?s.flags:0}hasFlag(t){return(this.flags&t)>0}hasMechFlag(t){return(this.mechFlags&t)>0}hasFlags(t,i){return(!t||this.flags&t)&&(!i||this.mechFlags&i)}activatesOn(t){return!!this.activates[t]}getName(t){let e={};if(!0===t||!1===t||"string"==typeof t?e.article=t:t&&(e=t),!e.article&&!e.color)return this.name;let s=this.name;if(e.color){let t=e.color;!0===e.color&&(t=this.fg),"string"!=typeof t&&(t=i.color.from(t).toString()),s=`Ω${t}Ω${this.name}∆`}if(e.article){s=("string"==typeof e.article?e.article:this.article||"a")+" "+s}return s}getDescription(t={}){return this.getName(t)}}function V(t){return new p(t)}i.make.tile=V;const G={};function H(...t){let e=t[0],s=t[1],l=t[2];1==arguments.length?(l=t[0],s=l.Extends||{},e=l.id):2==arguments.length&&(l=s,s=l.Extends||l.extends||{}),"string"==typeof s&&(s=G[s]||i.utils.ERROR("Unknown base tile: "+s)),l.id=e;const r=new p(l,s);return G[e]=r,r}var Y={__proto__:null,get Flags(){return r},get MechFlags(){return _},get Layer(){return e},Tile:p,make:V,tiles:G,install:H,installAll:function(t){Object.entries(t).forEach((([t,i])=>{i.id=t,H(t,i)}))}};i.color.install("cursorColor",25,100,150),i.config.cursorPathIntensity=50;class b{constructor(){this.mixer=new i.canvas.Mixer,this.item=null,this.itemQuantity=0,this.actor=null,this.tile=null,this.cellFlags=0,this.cellMechFlags=0,this.tileFlags=0,this.tileMechFlags=0}nullify(){this.mixer.nullify(),this.item=null,this.itemQuantity=0,this.actor=null,this.tile=null,this.cellFlags=0,this.cellMechFlags=0,this.tileFlags=0,this.tileMechFlags=0}copy(t){const i=this.mixer;Object.assign(this,t),this.mixer=i,this.mixer.copy(t.mixer)}}class W{constructor(){this.layers=[],this.sprites=null,this._actor=null,this._item=null,this.data={},this.flags=a.CELL_DEFAULT,this.mechFlags=0,this.gasVolume=0,this.liquidVolume=0,this.machineNumber=0,this.memory=new b,this.light=[100,100,100],this.oldLight=[100,100,100],this.glowLight=[100,100,100]}copy(t){i.utils.copyObject(this,t)}nullify(){for(let t=0;t<this.layers.length;++t)this.layers[t]=null;this.sprites=null,this._actor=null,this._item=null,this.data={},this.flags=a.CELL_DEFAULT,this.mechFlags=0,this.gasVolume=0,this.liquidVolume=0,this.machineNumber=0,this.memory.nullify(),this.light=[100,100,100],this.oldLight=[100,100,100],this.glowLight=[100,100,100]}nullifyLayers(t=!1,i=!1,e=!1){t&&(this.layers[1]=null,this.liquidVolume=0),i&&(this.layers[2]=null),e&&(this.layers[3]=null,this.gasVolume=0),this.flags|=a.CELL_CHANGED}get ground(){var t;return(null===(t=this.layers[e.GROUND])||void 0===t?void 0:t.id)||null}get liquid(){var t;return(null===(t=this.layers[e.LIQUID])||void 0===t?void 0:t.id)||null}get surface(){var t;return(null===(t=this.layers[e.SURFACE])||void 0===t?void 0:t.id)||null}get gas(){var t;return(null===(t=this.layers[e.GAS])||void 0===t?void 0:t.id)||null}get groundTile(){return this.layers[e.GROUND]||G.NULL}get liquidTile(){return this.layers[e.LIQUID]||G.NULL}get surfaceTile(){return this.layers[e.SURFACE]||G.NULL}get gasTile(){return this.layers[e.GAS]||G.NULL}dump(){if(this.actor)return this.actor.sprite.ch;if(this.item)return this.item.sprite.ch;for(let t=this.layers.length-1;t>=0;--t){if(!this.layers[t])continue;const i=this.layers[t]||G.NULL;if(i.ch)return i.ch}return G[0].ch}changed(){return this.flags&a.CELL_CHANGED}isVisible(){return this.flags&a.VISIBLE}isAnyKindOfVisible(){return this.flags&a.ANY_KIND_OF_VISIBLE}isOrWasAnyKindOfVisible(){return this.flags&a.IS_WAS_ANY_KIND_OF_VISIBLE}isRevealed(t=!1){const i=a.REVEALED|(t?a.MAGIC_MAPPED:0);return this.flags&i}listInSidebar(){return this.hasTileMechFlag(_.TM_LIST_IN_SIDEBAR,!0)}_needsRedraw(){this.flags|=a.NEEDS_REDRAW}hasVisibleLight(){return N(this.light)>i.config.light.INTENSITY_DARK}isDark(){return N(this.light)<=i.config.light.INTENSITY_DARK}lightChanged(){return this.flags&a.LIGHT_CHANGED}tile(t=e.GROUND){return this.layers[t]||G.NULL}*tiles(){for(let t of this.layers)t&&(yield t)}tileFlags(t=!1){if(t&&!this.isVisible())return this.memory.tileFlags;let i=0;for(let t of this.tiles())i|=t.flags;return i}tileMechFlags(t=!1){if(t&&!this.isVisible())return this.memory.tileMechFlags;let i=0;for(let t of this.tiles())i|=t.mechFlags;return i}hasTileFlag(t=0,i=!1){return!!(t&this.tileFlags(i))}hasAllTileFlags(t=0){return(t&this.tileFlags())===t}hasTileMechFlag(t=0,i=!1){return!!(t&this.tileMechFlags(i))}hasAllTileMechFlags(t=0){return(t&this.tileMechFlags())===t}setFlags(t=0,i=0){this.flags|=t,this.mechFlags|=i}clearFlags(t=0,i=0){this.flags&=~t,this.mechFlags&=~i}hasFlag(t=0,i=!1){return!!(t&(i&&!this.isAnyKindOfVisible()?this.memory.cellFlags:this.flags))}hasMechFlag(t=0,i=!1){return!!(t&(i&&!this.isAnyKindOfVisible()?this.memory.cellMechFlags:this.mechFlags))}hasTile(t){let i;return i=t instanceof p?t.id:t,this.layers.some((t=>t&&t.id===i))}successorTileFlags(t){let i=0;for(let e of this.tiles())i|=e.successorFlags(t);return i}promotedTileFlags(){return this.successorTileFlags("promote")}discoveredTileFlags(){return this.successorTileFlags("discover")}hasDiscoveredTileFlag(t){return this.discoveredTileFlags()&t}highestPriorityTile(t=!1){let i=G[0],s=-1e4;for(let l=e.GROUND;l<=(t?e.LIQUID:e.GAS);++l){const t=this.layers[l];t&&(t.priority>s&&(i=t,s=t.priority))}return i}tileWithFlag(t){for(let i of this.tiles())if(i.flags&t)return i;return null}tileWithMechFlag(t){for(let i of this.tiles())if(i.mechFlags&t)return i;return null}tileDesc(){return this.highestPriorityTile().desc}tileFlavor(){return this.highestPriorityTile().flavor}getName(t={}){return this.highestPriorityTile().getName(t)}isNull(){return null==this.ground}isEmpty(){return!(this._actor||this._item)}isPassableNow(t=!1){const i=t&&!this.isAnyKindOfVisible()?this.memory.tileFlags:this.tileFlags();return!(i&r.T_PATHING_BLOCKER)||(!!(i&r.T_BRIDGE)||!t&&this.isSecretDoor(t))}canBePassed(t=!1){if(this.isPassableNow(t))return!0;let i=t&&!this.isAnyKindOfVisible()?this.memory.tileMechFlags:this.tileMechFlags();return!!(i&_.TM_CONNECTS_LEVEL)||!(!(i&_.TM_PROMOTES)||this.promotedTileFlags()&r.T_PATHING_BLOCKER)}isWall(t=!1){return!!((t&&!this.isAnyKindOfVisible()?this.memory.tileFlags:this.tileFlags())&r.T_OBSTRUCTS_EVERYTHING)}isObstruction(t=!1){return!!((t&&!this.isAnyKindOfVisible()?this.memory.tileFlags:this.tileFlags())&r.T_OBSTRUCTS_DIAGONAL_MOVEMENT)}isDoor(t=!1){return!!((t&&!this.isAnyKindOfVisible()?this.memory.tileFlags:this.tileFlags())&r.T_IS_DOOR)}isSecretDoor(t=!1){if(t)return!1;return!(!(this.tileMechFlags()&_.TM_IS_SECRET)||this.discoveredTileFlags()&r.T_PATHING_BLOCKER)}blocksPathing(t=!1){return!!((t&&!this.isAnyKindOfVisible()?this.memory.tileFlags:this.tileFlags())&r.T_PATHING_BLOCKER)}blocksVision(){return!!(this.tileFlags()&r.T_OBSTRUCTS_VISION)}isLiquid(t=!1){return!!((t&&!this.isAnyKindOfVisible()?this.memory.tileFlags:this.tileFlags())&r.T_IS_LIQUID)}hasGas(t=!1){return!!((t&&!this.isAnyKindOfVisible()?this.memory.tileFlags:this.tileFlags())&r.T_GAS)}markRevealed(){return this.flags&=~a.STABLE_MEMORY,!(this.flags&a.REVEALED)&&(this.flags|=a.REVEALED,this.hasTileFlag(r.T_PATHING_BLOCKER)||i.data.xpxpThisTurn++,!0)}obstructsLayer(t){return t==e.SURFACE&&this.hasTileFlag(r.T_OBSTRUCTS_SURFACE)}_setTile(t=null,s=0,l){let _;l=l||i.data.map,null===t?(_=G.NULL,t=null):"string"==typeof t?_=G[t]:t instanceof p?(_=t,t=_.id):t&&i.utils.ERROR("Unknown tile: "+t),_||(i.utils.WARN("Unknown tile - "+t),_=G.NULL,t=null);const n=this.layers[_.layer]||G.NULL,E=n===G.NULL?null:n.id;(n.flags&r.T_PATHING_BLOCKER)!=(_.flags&r.T_PATHING_BLOCKER)&&(i.data.staleLoopMap=!0),_.flags&r.T_IS_FIRE&&!(n.flags&r.T_IS_FIRE)&&this.setFlags(0,T.CAUGHT_FIRE_THIS_TURN);const o=_.flags&r.T_OBSTRUCTS_VISION,S=n.flags&r.T_OBSTRUCTS_VISION;return l&&this.isAnyKindOfVisible()&&o!=S&&l.setFlag(h.MAP_FOV_CHANGED),null!==E&&this.removeSprite(n),this.layers[_.layer]=null===t?null:_,null!==t&&this.addSprite(_.layer,_),_.layer==e.LIQUID?(this.liquidVolume=s+(t==E?this.liquidVolume:0),l&&l.clearFlag(h.MAP_NO_LIQUID)):_.layer==e.GAS&&(this.gasVolume=s+(t==E?this.gasVolume:0),l&&l.clearFlag(h.MAP_NO_GAS)),_.layer>0&&null===this.layers[0]&&(this.layers[0]=G.FLOOR),this.flags|=a.CELL_CHANGED,l&&n.light!==_.light&&l.clearFlag(h.MAP_STABLE_GLOW_LIGHTS|h.MAP_STABLE_LIGHTS),!0}clearLayer(t){"string"==typeof t&&(t=e[t]);const i=this.layers[t];i&&(this.flags|=a.CELL_CHANGED,this.removeSprite(i)),this.layers[t]=null,t==e.LIQUID?this.liquidVolume=0:t==e.GAS&&(this.gasVolume=0)}clearLayers(t,i){const s=i?G[i]:this.layers[0];for(let i=0;i<this.layers.length;i++)i!=t&&i!=e.GAS&&(this.layers[i]=i?null:s);this.flags|=a.CELL_CHANGED}nullifyTileWithFlags(t,i=0){for(let e=0;e<this.layers.length;++e){const s=this.layers[e];s&&(t&&i?s.flags&t&&s.mechFlags&i&&(this.layers[e]=null):t?s.flags&t&&(this.layers[e]=null):i&&s.flags&i&&(this.layers[e]=null))}this.flags|=a.CELL_CHANGED}async activate(t,e={}){e.cell=this;let s=!1;for(let l of this.tiles()){if(!l.activates)continue;const r=l.activates[t];if(r){if(r.chance&&!i.random.chance(r.chance,1e4))continue;if(e.tile=l,s=await S(r,e)||s,s)break}}return s}activatesOn(t){for(let i of this.tiles())if(i.activatesOn(t))return!0;return!1}get item(){return this._item}set item(t){this.item&&this.removeSprite(this.item.sprite),this._item=t,t?(this.flags|=a.HAS_ITEM,this.addSprite(e.ITEM,t.sprite)):this.flags&=~a.HAS_ITEM}get actor(){return this._actor}set actor(t){this.actor&&this.removeSprite(this.actor.sprite),this._actor=t,t?(this.flags|=a.HAS_ACTOR,this.addSprite(e.ACTOR,t.sprite)):this.flags&=~a.HAS_ACTOR}addSprite(t,i,e=50){if(!i)return;if(this.flags|=a.CELL_CHANGED,!this.sprites||this.sprites.layer>t||this.sprites.layer==t&&this.sprites.priority>e)return void(this.sprites={layer:t,priority:e,sprite:i,next:this.sprites});let s=this.sprites;for(;s.next&&(s.layer<t||s.layer==t&&s.priority<=e);)s=s.next;const l={layer:t,priority:e,sprite:i,next:s.next};s.next=l}removeSprite(t){if(!t)return!1;if(!this.sprites)return!1;if(this.flags|=a.CELL_CHANGED,this.sprites&&this.sprites.sprite===t)return this.sprites=this.sprites.next,!0;let i=this.sprites,e=this.sprites.next;for(;e;){if(e.sprite===t)return i.next=e.next,!0;i=e,e=e.next}return!1}storeMemory(){const t=this.memory;t.tileFlags=this.tileFlags(),t.tileMechFlags=this.tileMechFlags(),t.cellFlags=this.flags,t.cellMechFlags=this.mechFlags,t.tile=this.highestPriorityTile(),this.item?(t.item=this.item,t.itemQuantity=this.item.quantity):(t.item=null,t.itemQuantity=0),t.actor=this.actor,w(this,t.mixer),this.actor&&this.isOrWasAnyKindOfVisible()&&(this.actor.rememberedInCell&&this.actor.rememberedInCell!==this&&(this.actor.rememberedInCell.storeMemory(),this.actor.rememberedInCell.flags|=a.NEEDS_REDRAW),this.actor.rememberedInCell=this)}}function v(t){const i=new W;return t&&i._setTile(t),i}function w(t,s){const l=t.memory.mixer;l.blackOut();let r=t.tileMechFlags()&_.TM_VISUALLY_DISTINCT,a=t.sprites;for(;a;){let s=a.sprite.opacity||100;a.layer==e.LIQUID?s=i.utils.clamp(t.liquidVolume||0,20,100):a.layer==e.GAS&&(s=i.utils.clamp(t.gasVolume||0,20,100)),l.drawSprite(a.sprite,s),a=a.next}return l.fg.multiply(t.light),l.bg.multiply(t.light),l.bake(!t.isAnyKindOfVisible()),r&&i.color.separate(l.fg,l.bg),s.drawSprite(l),!0}i.make.cell=v;var K={__proto__:null,get Flags(){return a},get MechFlags(){return T},CellMemory:b,Cell:W,make:v,getAppearance:w};i.utils.setDefaults(i.config,{"map.deepestLevel":99});class x{constructor(t,e,s={}){this.locations={},this.config={},this._actors=null,this._items=null,this.flags=0,this.ambientLight=null,this.lights=null,this.events={},this._width=t,this._height=e,this.cells=i.grid.make(t,e,(()=>new W)),this.locations=s.locations||{},this.config=Object.assign({},s),this.config.tick=this.config.tick||100,this._actors=null,this._items=null,this.flags=i.flag.from(h,h.MAP_DEFAULT,s.flags),this.ambientLight=null;const l=s.ambient||s.ambientLight||s.light;l&&(this.ambientLight=i.color.make(l)),this.lights=null,this.id=s.id,this.events=s.events||{}}get width(){return this._width}get height(){return this._height}async start(){}nullify(){this.cells.forEach((t=>t.nullify()))}dump(t){this.cells.dump(t||(t=>t.dump()))}cell(t,i){return this.cells[t][i]}eachCell(t){this.cells.forEach(((i,e,s)=>t(i,e,s,this)))}forEach(t){this.cells.forEach(((i,e,s)=>t(i,e,s,this)))}forRect(t,i,e,s,l){this.cells.forRect(t,i,e,s,((t,i,e)=>l(t,i,e,this)))}eachNeighbor(t,i,e,s=!1){this.cells.eachNeighbor(t,i,((t,i,s)=>e(t,i,s,this)),s)}hasXY(t,i){return this.cells.hasXY(t,i)}isBoundaryXY(t,i){return this.cells.isBoundaryXY(t,i)}changed(t){return!0===t?this.flags|=h.MAP_CHANGED:!1===t&&(this.flags&=~h.MAP_CHANGED),this.flags&h.MAP_CHANGED}hasCellFlag(t,i,e){return this.cell(t,i).flags&e}hasCellMechFlag(t,i,e){return this.cell(t,i).mechFlags&e}hasTileFlag(t,i,e){return this.cell(t,i).hasTileFlag(e)}hasTileMechFlag(t,i,e){return this.cell(t,i).hasTileMechFlag(e)}setCellFlag(t,i,e){this.cell(t,i).flags|=e}redrawCell(t){t._needsRedraw(),this.flags|=h.MAP_CHANGED}redrawXY(t,i){const e=this.cell(t,i);this.redrawCell(e)}redrawAll(){this.forEach((t=>{t.flags|=a.NEEDS_REDRAW})),this.flags|=h.MAP_CHANGED}revealAll(){this.forEach((t=>{t.markRevealed(),t.storeMemory()}))}markRevealed(t,e){this.cell(t,e).markRevealed()&&i.data.player&&i.data.player.invalidateCostMap()}isVisible(t,i){return this.cell(t,i).isVisible()}isAnyKindOfVisible(t,i){return this.cell(t,i).isAnyKindOfVisible()}isOrWasAnyKindOfVisible(t,i){return this.cell(t,i).isOrWasAnyKindOfVisible()}hasVisibleLight(t,i){return this.cell(t,i).hasVisibleLight()}setFlag(t){this.flags|=t,this.changed(!0)}setFlags(t=0,i=0,e=0){t&&(this.flags|=t),(i||e)&&this.forEach((t=>t.setFlags(i,e))),this.changed(!0)}clearFlag(t){this.flags&=~t,this.changed(!0)}clearFlags(t=0,i=0,e=0){t&&(this.flags&=~t),(i||e)&&this.forEach((t=>t.clearFlags(i,e))),this.changed(!0)}setCellFlags(t,i,e=0,s=0){this.cell(t,i).setFlags(e,s),this.flags|=h.MAP_CHANGED}clearCellFlags(t,i,e=0,s=0){this.cell(t,i).clearFlags(e,s),this.changed(!0)}hasTile(t,i,e){return this.cells[t][i].hasTile(e)}tileFlags(t,i,e=!1){return this.cells[t][i].tileFlags(e)}tileMechFlags(t,i,e=!1){return this.cells[t][i].tileMechFlags(e)}tileWithFlag(t,i,e=0){return this.cells[t][i].tileWithFlag(e)}tileWithMechFlag(t,i,e=0){return this.cells[t][i].tileWithMechFlag(e)}hasKnownTileFlag(t,i,e=0){return this.cells[t][i].memory.tileFlags&e}discoveredTileFlags(t,i){return this.cells[t][i].discoveredTileFlags()}hasDiscoveredTileFlag(t,i,e=0){return this.cells[t][i].hasDiscoveredTileFlag(e)}canBePassed(t,i,e=!1){return this.cells[t][i].canBePassed(e)}isPassableNow(t,i,e=!1){return this.cells[t][i].isPassableNow(e)}isNull(t,i){return this.cells[t][i].isNull()}isEmpty(t,i){return this.cells[t][i].isEmpty()}isObstruction(t,i,e=!1){return this.cells[t][i].isObstruction(e)}isDoor(t,i,e=!1){return this.cells[t][i].isDoor(e)}isLiquid(t,i,e=!1){return this.cells[t][i].isLiquid(e)}hasGas(t,i,e=!1){return this.cells[t][i].hasGas(e)}blocksPathing(t,i,e=!1){return this.cells[t][i].blocksPathing(e)}blocksVision(t,i){return this.cells[t][i].blocksVision()}highestPriorityTile(t,i,e=!1){return this.cells[t][i].highestPriorityTile(e)}tileFlavor(t,i){return this.cells[t][i].tileFlavor()}setTile(t,i,e,s=0){return this.cell(t,i)._setTile(e,s,this)}nullifyTileWithFlags(t,i,e,s=0){this.cell(t,i).nullifyTileWithFlags(e,s)}nullifyCellLayers(t,i,e=!0,s=!0,l=!0){return this.changed(!0),this.cell(t,i).nullifyLayers(e,s,l)}fill(t,i){let e,s;for(void 0===i&&(i=t),e=0;e<this.width;++e)for(s=0;s<this.height;++s)this.isBoundaryXY(e,s)?this.setTile(e,s,i):this.setTile(e,s,t)}neighborCount(t,i,e,s=!1){let l=0;return this.eachNeighbor(t,i,((...t)=>{e(...t)&&++l}),s),l}passableArcCount(t,i){return this.hasXY(t,i)?this.cells.arcCount(t,i,(t=>t.isPassableNow())):-1}diagonalBlocked(t,i,e,s,l=!1){if(t==e||i==s)return!1;if(this.tileFlags(t,s,l)&r.T_OBSTRUCTS_DIAGONAL_MOVEMENT)return!0;return!!(this.tileFlags(e,i,l)&r.T_OBSTRUCTS_DIAGONAL_MOVEMENT)}fillCostGrid(t,e){e=e||i.utils.ONE,this.cells.forEach(((s,l,r)=>{s.isNull()?t[l][r]=i.path.OBSTRUCTION:t[l][r]=s.canBePassed()?e(s,l,r,this):i.path.OBSTRUCTION}))}matchingNeighbor(t,e,s,l=!1){const r=l?4:8;for(let l=0;l<r;++l){const r=i.utils.DIRS[l],_=t+r[0],a=e+r[1];if(this.hasXY(_,a)&&s(this.cells[_][a],_,a,this))return[_,a]}return null}matchingLocNear(t,e,...s){let l,r,_,a=s[0],T=s[1]||{};const h=s[0];"function"!=typeof h&&(T=h||s[1],a=T.match||i.utils.TRUE);const n=T.hallways||!1,E=T.blockingMap||null,o=!1===T.liquids,S=T.deterministic||!1,c=[];for(_=0;_<Math.max(this.width,this.height)&&!c.length;_++)for(l=t-_;l<=t+_;l++)for(r=e-_;r<=e+_;r++){if(!this.hasXY(l,r))continue;const s=this.cell(l,r);Math.ceil(i.utils.distanceBetween(t,e,l,r))!=_||E&&E[l][r]||!a(s,l,r,this)||o&&s.liquid||!(n||this.passableArcCount(l,r)<2)||c.push([l,r])}if(0==c.length)return[-1,-1];let A=0;return A=S?Math.floor(c.length/2):i.random.number(c.length),c[A]}randomMatchingLoc(t={}){let e,s,l;"function"==typeof t&&(t={match:t});const r=t.hallways||!1,_=t.blockingMap||null,a=!1===t.liquids,T=t.match||i.utils.TRUE,h=t.forbidCellFlags||0,n=t.forbidTileFlags||0,E=t.forbidTileMechFlags||0,o=t.tile||null;let S=t.tries||500,c=!0;for(;c&&(S--,S);)e=i.random.range(0,this.width-1),s=i.random.range(0,this.height-1),l=this.cell(e,s),_&&_[e][s]||o&&!l.hasTile(o)||a&&l.liquid||h&&l.flags&h||n&&l.hasTileFlag(n)||E&&l.hasTileMechFlag(E)||!(r||this.passableArcCount(e,s)<2)||!T(l,e,s,this)||(c=!1);return!!S&&[e,s]}addLight(t,i,e){const s={x:t,y:i,light:e,next:this.lights};return this.lights=s,this.flags&=~(h.MAP_STABLE_LIGHTS|h.MAP_STABLE_GLOW_LIGHTS),s}removeLight(t){i.utils.removeFromChain(this,"lights",t),this.flags&=~(h.MAP_STABLE_LIGHTS|h.MAP_STABLE_GLOW_LIGHTS)}eachGlowLight(t){i.utils.eachChain(this.lights,(i=>t(i.light,i.x,i.y))),this.eachCell(((i,e,s)=>{for(let l of i.tiles())l.light&&t(l.light,e,s)}))}eachDynamicLight(t){i.utils.eachChain(this._actors,(i=>{i.light&&t(i.light,i.x,i.y)}))}addFx(t,i,s){if(!this.hasXY(t,i))return!1;const l=this.cell(t,i);return l.addSprite(e.FX,s.sprite),s.x=t,s.y=i,this.redrawCell(l),!0}moveFx(t,i,s){if(!this.hasXY(t,i))return!1;const l=this.cell(t,i),r=this.cell(s.x,s.y);return r.removeSprite(s.sprite),this.redrawCell(r),l.addSprite(e.FX,s.sprite),this.redrawCell(l),s.x=t,s.y=i,!0}removeFx(t){const i=this.cell(t.x,t.y);return i.removeSprite(t.sprite),this.redrawCell(i),this.flags|=h.MAP_CHANGED,!0}actorAt(t,i){if(!this.hasXY(t,i))return null;return this.cell(t,i).actor}addActor(t,s,l){if(!this.hasXY(t,s))return!1;const r=this.cell(t,s);if(r.actor)return!1;r.actor=l,l.next=this._actors,this._actors=l;const _=l===i.data.player?e.PLAYER:e.ACTOR;r.addSprite(_,l.sprite);const T=l===i.data.player?a.HAS_PLAYER:a.HAS_MONSTER;return r.flags|=T,l.light&&(this.flags&=~h.MAP_STABLE_LIGHTS),(l.isPlayer()||r.isAnyKindOfVisible()&&l.blocksVision())&&(this.flags|=h.MAP_FOV_CHANGED),l.x=t,l.y=s,this.redrawCell(r),!0}addActorNear(t,i,e){const s=this.matchingLocNear(t,i,(t=>e.avoidsCell(t)));return!(!s||s[0]<0)&&this.addActor(s[0],s[1],e)}moveActor(t,i,e){return!!this.hasXY(t,i)&&(this.removeActor(e),this.addActor(t,i,e)?(e.light&&(this.flags&=~h.MAP_STABLE_LIGHTS),!0):(this.addActor(e.x,e.y,e),!1))}removeActor(t){if(!this.hasXY(t.x,t.y))return!1;const e=this.cell(t.x,t.y);return e.actor===t&&(e.actor=null,i.utils.removeFromChain(this,"actors",t),e.flags&=~a.HAS_ACTOR,e.removeSprite(t.sprite),t.light&&(this.flags&=~h.MAP_STABLE_LIGHTS),(t.isPlayer()||e.isAnyKindOfVisible()&&t.blocksVision())&&(this.flags|=h.MAP_FOV_CHANGED),this.redrawCell(e),!0)}deleteActorAt(t,i){const e=this.actorAt(t,i);return!!e&&(this.removeActor(e),e.delete(),!0)}itemAt(t,i){return this.cell(t,i).item}addItem(t,s,l){if(!this.hasXY(t,s))return!1;const r=this.cell(t,s);return!(r.flags&a.HAS_ITEM)&&(l.x=t,l.y=s,r.item=l,l.next=this._items,this._items=l,r.addSprite(e.ITEM,l.sprite),r.flags|=a.HAS_ITEM,l.light&&(this.flags&=~h.MAP_STABLE_LIGHTS),this.redrawCell(r),(l.isDetected()||i.config.D_ITEM_OMNISCIENCE)&&(r.flags|=a.ITEM_DETECTED),!0)}addItemNear(t,i,e){const s=this.matchingLocNear(t,i,(t=>e.forbidsCell(t)));return!(!s||s[0]<0)&&this.addItem(s[0],s[1],e)}removeItem(t){const e=t.x,s=t.y;if(!this.hasXY(e,s))return!1;const l=this.cell(e,s);return l.item===t&&(l.removeSprite(t.sprite),l.item=null,i.utils.removeFromChain(this,"items",t),t.light&&(this.flags&=~h.MAP_STABLE_LIGHTS),l.flags&=~(a.HAS_ITEM|a.ITEM_DETECTED),this.redrawCell(l),!0)}gridDisruptsPassability(t,e={}){const s=i.grid.alloc(this.width,this.height);let l=!1;const _=e.gridOffsetX||0,a=e.gridOffsetY||0,T=e.bounds||null;this.cells.forEach(((i,e,h)=>{if(T&&!T.contains(e,h))return;const n=e+_,E=h+a;if(!i.isNull())if(i.canBePassed()){if(t.hasXY(n,E)&&t[n][E])return;s[e][h]=1}else i.hasTileFlag(r.T_HAS_STAIRS)&&(t.hasXY(n,E)&&t[n][E]?l=!0:s[e][h]=1)}));let h=!0;for(let t=0;t<s.width&&!l;++t)for(let i=0;i<s.height&&!l;++i)1==s[t][i]&&(h?(s.floodFill(t,i,1,2),h=!1):l=!0);return i.grid.free(s),l}calcFov(t,e,s,l,_=0,a=r.T_OBSTRUCTS_VISION){l=l||this.width+this.height,t.fill(0);const T=this;return new i.fov.FOV({isBlocked:(i,e)=>!(t.hasXY(i,e)&&!T.hasCellFlag(i,e,_)&&!T.hasTileFlag(i,e,a)),calcRadius:(t,i)=>Math.sqrt(t**2+i**2),setVisible(i,e){t[i][e]=1},hasXY:(i,e)=>t.hasXY(i,e)}).calculate(e,s,l)}losFromTo(t,e){const s=i.utils.getLine(t.x,t.y,e.x,e.y);return!(!s||!s.length)&&!s.some((t=>this.blocksVision(t[0],t[1])))}storeMemory(t,i){this.cell(t,i).storeMemory()}storeMemories(){let t,i;for(t=0;t<this.width;++t)for(i=0;i<this.height;++i){const e=this.cell(t,i);e.flags&a.ANY_KIND_OF_VISIBLE&&this.storeMemory(t,i),e.flags&=a.PERMANENT_CELL_FLAGS,e.mechFlags&=T.PERMANENT_MECH_FLAGS}}async tick(){this.forEach((t=>t.mechFlags&=~(T.EVENT_FIRED_THIS_TURN|T.EVENT_PROTECTED)));for(let t=0;t<this.width;++t)for(let i=0;i<this.height;++i){const e=this.cells[t][i];await e.activate("tick",{map:this,x:t,y:i,cell:e,safe:!0})}X(this)}resetEvents(){this.forEach((t=>t.mechFlags&=~(T.EVENT_FIRED_THIS_TURN|T.EVENT_PROTECTED)))}}function k(t,e,s={},l){"string"==typeof s&&(s={tile:s},l&&(s.wall=l));const r=new x(t,e,s),_=s.tile||s.floor||s.floorTile,a=s.boundary||s.wall||s.wallTile;return _&&r.fill(_,a),i.data.map||(i.data.map=r),r}function X(t){if(t.flags&h.MAP_NO_LIQUID)return;const s=i.grid.alloc(t.width,t.height);t.forEach(((e,l,_)=>{if(e.hasTileFlag(r.T_OBSTRUCTS_LIQUID))return;let a=e.liquid,T=e.liquidVolume,h=1;t.eachNeighbor(l,_,(t=>{t.hasTileFlag(r.T_OBSTRUCTS_LIQUID)||(++h,t.liquidVolume>T&&(a=t.liquid,T=t.liquidVolume))}));let n=e.liquidVolume;if(n>10&&h>1){let i=Math.round(.2*e.liquidVolume);i>5&&(n-=i,e.liquid!=a&&e._setTile(a,n,t),i&&s.eachNeighbor(l,_,((t,e,l)=>{s[e][l]=t+i})))}s[l][_]+=n;const E=e.liquidTile;s[l][_]>0&&i.random.chance(E.dissipate,1e4)&&(s[l][_]-=1)}));let l=!1;s.forEach(((i,s,r)=>{const _=t.cell(s,r);i?(l=!0,_.liquid&&_.liquidVolume!==i&&(_.liquidVolume=i,t.redrawCell(_))):_.liquid&&(_.clearLayer(e.LIQUID),t.redrawCell(_))})),l?t.flags&=~h.MAP_NO_LIQUID:t.flags|=h.MAP_NO_LIQUID,t.changed(!0),i.grid.free(s)}i.make.map=k;var Q={__proto__:null,get Flags(){return h},Map:x,make:k,getCellAppearance:function(t,e,s,l){if(l.blackOut(),!t.hasXY(e,s))return;const r=t.cell(e,s);r.isAnyKindOfVisible()&&r.flags&(a.CELL_CHANGED|a.NEEDS_REDRAW)?w(r,l):r.isRevealed()&&l.drawSprite(r.memory.mixer),r.isVisible()||(r.isRevealed()?r.isAnyKindOfVisible()||(l.bg.mix(i.colors.black,30),l.fg.mix(i.colors.black,30)):l.blackOut());let T=!1;if(r.flags&(a.IS_CURSOR|a.IS_IN_PATH)){const t=r.flags&a.IS_CURSOR?i.colors.cursorColor:i.colors.yellow;r.hasTileMechFlag(_.TM_INVERT_WHEN_HIGHLIGHTED)?i.color.swap(l.fg,l.bg):l.bg.mix(t,i.config.cursorPathIntensity||20),T=!0}T&&i.color.separate(l.fg,l.bg)},addText:function(t,s,l,r,_,a,T){for(let h of r){const r=i.canvas.makeSprite(h,_,a);t.cell(s++,l).addSprite(T||e.GROUND,r)}},updateGas:function(t){if(t.flags&h.MAP_NO_GAS)return;const s=i.grid.alloc(t.width,t.height);t.forEach(((e,l,_)=>{if(e.hasTileFlag(r.T_OBSTRUCTS_GAS))return;let a=e.gas,T=e.gasVolume,h=e.gasVolume,n=1;if(t.eachNeighbor(l,_,(t=>{t.hasTileFlag(r.T_OBSTRUCTS_GAS)||(++n,h+=t.gasVolume,t.gasVolume>T&&(a=t.gas,T=t.gasVolume))})),!h)return;const E=Math.floor(h/n);e.gas!=a&&e._setTile(a,E,t),s[l][_]+=E;const o=h-n*Math.floor(h/n);o&&i.random.number(n)<o&&(s[l][_]+=1)}));let l=!1;s.forEach(((i,s,r)=>{const _=t.cell(s,r);i?(l=!0,_.gas&&_.gasVolume!==i&&(_.gasVolume=i,t.redrawCell(_))):_.gas&&(_.clearLayer(e.GAS),t.redrawCell(_))})),l?t.flags&=~h.MAP_NO_GAS:t.flags|=h.MAP_NO_GAS,t.changed(!0),i.grid.free(s)},updateLiquid:X};H("NULL",{ch:"∅",fg:"white",bg:"black",flags:"T_OBSTRUCTS_PASSABILITY",name:"eerie nothingness",article:"an",priority:0}),H("FLOOR",{ch:"·",fg:[30,30,30,20,0,0,0],bg:[2,2,10,0,2,2,0],priority:10,article:"the"}),H("DOOR",{ch:"+",fg:[100,40,40],bg:[30,60,60],priority:30,flags:"T_IS_DOOR, T_OBSTRUCTS_TILE_EFFECTS, T_OBSTRUCTS_ITEMS, T_OBSTRUCTS_VISION, TM_VISUALLY_DISTINCT",article:"a",activates:{enter:{tile:"DOOR_OPEN"},open:{tile:"DOOR_OPEN_ALWAYS"}}}),H("DOOR_OPEN","DOOR",{ch:"'",fg:[100,40,40],bg:[30,60,60],priority:40,flags:"!T_OBSTRUCTS_ITEMS, !T_OBSTRUCTS_VISION",name:"open door",article:"an",activates:{tick:{tile:"DOOR",flags:"DFF_SUPERPRIORITY, DFF_ONLY_IF_EMPTY"},enter:null,open:null,close:{tile:"DOOR",flags:"DFF_SUPERPRIORITY, DFF_ONLY_IF_EMPTY"}}}),H("DOOR_OPEN_ALWAYS","DOOR_OPEN",{activates:{tick:null,close:{tile:"DOOR",flags:"DFF_SUPERPRIORITY, DFF_ONLY_IF_EMPTY"}}}),H("BRIDGE",{ch:"=",fg:[100,40,40],priority:40,layer:"SURFACE",flags:"T_BRIDGE, TM_VISUALLY_DISTINCT",article:"a"}),H("UP_STAIRS",{ch:"<",fg:[100,40,40],bg:[100,60,20],priority:200,flags:"T_UP_STAIRS, T_STAIR_BLOCKERS, TM_VISUALLY_DISTINCT, TM_LIST_IN_SIDEBAR",name:"upward staircase",article:"an"}),H("DOWN_STAIRS",{ch:">",fg:[100,40,40],bg:[100,60,20],priority:200,flags:"T_DOWN_STAIRS, T_STAIR_BLOCKERS, TM_VISUALLY_DISTINCT, TM_LIST_IN_SIDEBAR",name:"downward staircase",article:"a"}),H("WALL",{ch:"#",fg:[7,7,7,0,3,3,3],bg:[40,40,40,10,10,0,5],priority:100,flags:"T_OBSTRUCTS_EVERYTHING",article:"a"}),H("LAKE",{ch:"~",fg:[5,8,20,10,0,4,15,!0],bg:[10,15,41,6,5,5,5,!0],priority:50,flags:"T_DEEP_WATER",name:"deep water",article:"the"}),t.cell=K,t.light=B,t.lights=D,t.map=Q,t.tile=Y,t.tileEvent=L,t.tiles=G,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gw-map.min.js.map
